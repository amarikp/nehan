/*
 nehan.js
 Copyright (C) 2010-2014 Watanabe Masaki<lambda.watanabe[at]gmail.com>
 http://tb.antiscroll.com/docs/nehan/

 licensed under MIT license.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/

var Nehan;Nehan||(Nehan={}),Nehan.style={},Nehan.__single_tags__=[],Nehan.__single_tags_rex__=[],Nehan.setStyle=function(a,b){var c=Nehan.style[a]||{};for(var d in b)c[d]=b[d];Nehan.style[a]=c},Nehan.setStyles=function(a){for(var b in a)Nehan.setStyle(b,a[b])},Nehan.addSingleTag=function(a){Nehan.__single_tags__.push(a)},Nehan.addSingleTagRex=function(a){Nehan.__single_tags_rex__.push(a)},Nehan.setup=function(a){var b=a||{},c={lang:"ja-JP",debug:!1,kerning:!0,justify:!0,maxRollbackCount:40,maxPageCount:1e4,useVerticalGlyphIfEnable:!0,useStrictWordMetrics:!0,enableAutoCloseTag:!1,lexingBufferLen:2e3},d={root:"document",direction:"vert",boxFlow:{hori:"lr-tb",vert:"tb-rl"},pagingDirection:{hori:"lr",vert:"rl"},width:800,height:580,fontSize:16,maxFontSize:64,rubyRate:.5,boldRate:.5,lineRate:2,vertWordSpaceRate:.25,fontColor:"000000",linkColor:"0000FF",fontImgRoot:"http://nehan.googlecode.com/hg/char-img",fontFamily:"'ヒラギノ明朝 Pro W3','Hiragino Mincho Pro','HiraMinProN-W3','IPA明朝','IPA Mincho', 'Meiryo','メイリオ','ＭＳ 明朝','MS Mincho', monospace",fontSizeNames:{"xx-large":"33px","x-large":"24px",large:"18px",medium:"16px",small:"13px","x-small":"10px","xx-small":"8px",larger:"1.2em",smaller:"0.8em"},getMeasure:function(a){return this[a.getPropMeasure()]},getExtent:function(a){return this[a.getPropExtent()]},getPagingDirection:function(){return this.pagingDirection[this.direction]},getStdBoxFlow:function(){var a=this.boxFlow[this.direction];return W.getByName(a)},getStdVertFlow:function(){return W.getByName(this.boxFlow.vert)},getStdHoriFlow:function(){return W.getByName(this.boxFlow.hori)},getRtFontSize:function(a){var b=g.rt||null,c=b?b["font-size"]:null;return null===b||null===c?Math.round(this.rubyRate*a):Pb.prototype._computeUnitSize.call(this,c,a)},getPaletteFontColor:function(a){return a.getValue().toLowerCase()!==this.fontColor.toLowerCase()?a.getPaletteValue():this.fontColor}},e=function(){var a,b,c,d=navigator.appName,e=navigator.userAgent.toLowerCase(),f=e.indexOf("trident")>=0&&e.indexOf("msie")<0;if(f)a="msie",c=e.match(/rv:([\.\d]+)/i),b=c?parseInt(c[1],10):"";else{var g=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/);g?(c=e.match(/version\/([\.\d]+)/i),c&&(g[2]=c[1]),a=g[1].toLowerCase(),b=parseInt(g[2],10)):(a=d.toLowerCase(),b=parseInt(navigator.appVersion,10))}var h="msie"===a,i=e.indexOf("windows")>=0,j=e.indexOf("macintosh")>=0,k=a.indexOf("chrome")>=0,l=a.indexOf("safari")>=0,m=-1!=e.indexOf("iphone"),n=-1!=e.indexOf("ipod"),o=-1!=e.indexOf("ipad"),p=m||n||o,q=-1!=e.indexOf("android"),r=p||q,s=-1!=e.indexOf("webkit"),t=f||!(h&&8>=b),u=k&&(i||j)&&b>=24,v=l&&b>=5,w=u||v;return{version:b,isIE:h,isTrident:f,isChrome:k,isWebkit:s,isIphone:m,isIpod:n,isIpad:o,isIphoneFamily:p,isAndroidFamily:q,isSmartPhone:r,isTransformEnable:t,isVerticalGlyphEnable:w}}(),f=function(){var a=["br","hr","img","input","link","meta","wbr","?xml","!doctype","page-break","end-page","pbr"],b=[],c=function(b){return i.exists(a,q.eq(b))},d=function(a){return i.exists(b,function(b){return b.test(a)})},e=function(a){return i.exists(b,function(b){return a.source===b.source})};return{isSingleTag:function(a){return c(a)||d(a)||!1},addSingleTag:function(b){c(b)||a.push(b)},addSingleTagAll:function(a){return i.iter(a,this.addSingleTag)},addSingleTagRex:function(a){e(a)||b.push(a)},addSingleTagRexAll:function(a){return i.iter(a,this.addSingleTagRex)}}}(),g={a:{display:"inline"},abbr:{display:"inline"},address:{display:"inline","font-style":"italic",section:!0},area:{},article:{display:"block",section:!0},aside:{display:"block",section:!0},audio:{},b:{display:"inline","font-weight":"bold"},base:{},bdi:{display:"inline"},bdo:{display:"inline"},blockquote:{color:"#666666",display:"block","section-root":!0,padding:{start:"1em",end:"1em",before:"0.5em",after:"0.5em"},margin:{after:"1.5em"}},body:{display:"block","section-root":!0},br:{display:"inline"},button:{display:"inline",interactive:!0},canvas:{display:"inline",embeddable:!0},caption:{display:"table-caption","text-align":"center",margin:{after:"0.5em"}},cite:{display:"inline"},code:{"font-family":"'andale mono', 'lucida console', monospace",display:"inline"},col:{display:"table-column"},colgroup:{display:"table-column-group"},command:{},datalist:{},dd:{display:"block",margin:{start:"1em",end:"1em",after:"1.6em"}},del:{color:"#666666",display:"inline"},details:{display:"block","section-root":!0},dfn:{display:"inline","font-style":"italic"},div:{display:"block"},dl:{display:"block"},dt:{display:"block","font-weight":"bold",margin:{after:"0.2em"}},em:{display:"inline","font-style":"italic"},embed:{},fieldset:{display:"block","section-root":!0,padding:{start:"1em",end:"0.2em",before:"0.2em",after:"1em"},margin:{after:"1.5em"},"border-width":"1px"},figure:{display:"block","section-root":!0},figcaption:{display:"block","text-align":"center","font-size":"0.8em"},footer:{display:"block",section:!0},font:{display:"inline"},form:{display:"block"},h1:{display:"block","line-rate":1.4,"font-size":"2.4em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"0.5em"}},h2:{display:"block","line-rate":1.4,"font-size":"2.0em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"0.75em"}},h3:{display:"block","line-rate":1.4,"font-size":"1.6em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1em"}},h4:{display:"block","line-rate":1.4,"font-size":"1.4em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1.25em"}},h5:{display:"block","line-rate":1.4,"font-size":"1.0em","font-weight":"bold","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1.5em"}},h6:{display:"block","line-rate":1.4,"font-weight":"bold","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace","font-size":"1.0em"},head:{display:"none"},header:{display:"block",section:!0},hr:{display:"block","box-sizing":"content-box","border-color":"#b8b8b8","border-style":"solid",margin:{after:"1em"},extent:"1px","border-width":{before:"1px"}},"hr.nehan-space":{"border-width":"0px"},html:{display:"block"},i:{display:"inline"},iframe:{display:"block",embeddable:!0},ins:{},img:{display:"inline","box-sizing":"content-box"},input:{display:"inline",interactive:!0},kbd:{display:"inline"},keygen:{},label:{display:"inline"},legend:{display:"block","font-weight":"bold","line-rate":1.5},li:{display:"list-item",margin:{after:"0.6em"}},"li-marker":{display:"block"},"li-body":{display:"block"},link:{meta:!0},main:{display:"block"},map:{},mark:{display:"inline"},menu:{display:"block"},meta:{meta:!0},meter:{display:"inline"},nav:{display:"block",section:!0},noscript:{meta:!0},object:{display:"inline",embeddable:!0},ol:{display:"block","list-style-image":"none","list-style-position":"outside","list-style-type":"decimal",margin:{before:"1em"}},"ol ol":{margin:{before:"0em"}},"ol ul":{margin:{before:"0em"}},optgroup:{},option:{},output:{},p:{display:"block",margin:{after:"1.5em"}},param:{},pre:{display:"block","white-space":"pre"},progress:{display:"inline"},q:{display:"block"},rb:{display:"inline"},rp:{display:"inline"},ruby:{display:"inline"},rt:{"font-size":"0.5em","line-rate":1,display:"inline"},s:{display:"inline"},samp:{display:"inline"},script:{display:"inline",meta:!0},section:{display:"block",section:!0},select:{},small:{display:"inline","font-size":"0.8em"},source:{},span:{display:"inline"},strong:{display:"inline","font-weight":"bold"},style:{display:"inline",meta:!0},sub:{display:"inine"},summary:{display:"inline"},sup:{display:"inine"},table:{display:"table",embeddable:!0,"table-layout":"fixed","background-color":"white","border-collapse":"collapse","border-color":"#a8a8a8","border-style":"solid","border-width":{start:"1px",before:"1px"},margin:{start:"0.5em",end:"0.5em",after:"1.6em"}},tbody:{display:"table-row-group","border-collapse":"inherit"},td:{display:"table-cell","section-root":!0,"border-width":{end:"1px"},"border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid",padding:{start:"0.5em",end:"0.5em",before:"0.4em",after:"0.4em"}},textarea:{display:"inline",embeddable:!0,interactive:!0},tfoot:{display:"table-footer-group","border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid","font-style":"italic"},th:{display:"table-cell","line-rate":1.4,"border-width":{end:"1px"},"border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid",padding:{start:"0.5em",end:"0.5em",before:"0.4em",after:"0.4em"}},thead:{display:"table-header-group","font-weight":"bold","background-color":"#c3d9ff","border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid"},time:{display:"inline"},title:{meta:!0},tr:{display:"table-row","border-collapse":"inherit","border-color":"#a8a8a8","border-style":"solid","border-width":{after:"1px"}},track:{},u:{display:"inline"},ul:{display:"block","list-style-image":"none","list-style-type":"disc","list-style-position":"outside",margin:{before:"1em"}},"ul ul":{margin:{before:"0em"}},"ul ol":{margin:{before:"0em"}},"var":{display:"inline"},video:{display:"inline",embeddable:!0},wbr:{display:"inline"},"?xml":{},"!doctype":{},"first-line":{display:"block"},"page-break":{display:"inline"},pbr:{display:"inline"},"end-page":{display:"inline"},".nehan-rounded":{padding:{before:"1.6em",end:"1.0em",after:"1.6em",start:"1.0em"},"border-radius":"10px"},".nehan-xx-large":{"font-size":d.fontSizeNames["xx-large"]},".nehan-x-large":{"font-size":d.fontSizeNames["x-large"]},".nehan-large":{"font-size":d.fontSizeNames.large},".nehan-medium":{"font-size":d.fontSizeNames.medium},".nehan-small":{"font-size":d.fontSizeNames.small},".nehan-x-small":{"font-size":d.fontSizeNames["x-small"]},".nehan-xx-small":{"font-size":d.fontSizeNames["xx-small"]},".nehan-larger":{"font-size":d.fontSizeNames.larger},".nehan-smaller":{"font-size":d.fontSizeNames.smaller},".nehan-content-box":{"box-sizing":"content-box"},".nehan-border-box":{"box-sizing":"border-box"},".nehan-margin-box":{"box-sizing":"margin-box"},".nehan-disp-block":{display:"block"},".nehan-disp-inline":{display:"inline"},".nehan-disp-iblock":{display:"inline-block"},".nehan-ta-start":{"text-align":"start"},".nehan-ta-center":{"text-align":"center"},".nehan-ta-end":{"text-align":"end"},".nehan-float-start":{"float":"start"},".nehan-float-end":{"float":"end"},".nehan-flow-lr-tb":{flow:"lr-tb"},".nehan-flow-tb-rl":{flow:"tb-rl"},".nehan-flow-tb-lr":{flow:"tb-lr"},".nehan-flow-rl-tb":{flow:"rl-tb"},".nehan-flow-flip":{flow:"flip"},".nehan-lsp-inside":{"list-style-position":"inside"},".nehan-lsp-outside":{"list-style-position":"outside"},".nehan-lst-none":{"list-style-type":"none"},".nehan-lst-decimal":{"list-style-type":"decimal"},".nehan-lst-disc":{"list-style-type":"disc"},".nehan-lst-circle":{"list-style-type":"circle"},".nehan-lst-square":{"list-style-type":"square"},".nehan-lst-decimal-leading-zero":{"list-style-type":"decimal-leading-zero"},".nehan-lst-lower-alpha":{"list-style-type":"lower-alpha"},".nehan-lst-upper-alpha":{"list-style-type":"upper-alpha"},".nehan-lst-lower-latin":{"list-style-type":"lower-latin"},".nehan-lst-upper-latin":{"list-style-type":"upper-latin"},".nehan-lst-lower-roman":{"list-style-type":"lower-roman"},".nehan-lst-upper-roman":{"list-style-type":"upper-roman"},".nehan-lst-lower-greek":{"list-style-type":"lower-greek"},".nehan-lst-upper-greek":{"list-style-type":"upper-greek"},".nehan-lst-cjk-ideographic":{"list-style-type":"cjk-ideographic"},".nehan-lst-hiragana":{"list-style-type":"hiragana"},".nehan-lst-hiragana-iroha":{"list-style-type":"hiragana-iroha"},".nehan-lst-katakana":{"list-style-type":"katakana"},".nehan-lst-katakana-iroha":{"list-style-type":"katakana-iroha"},".nehan-tcy":{"text-combine":"horizontal"},".nehan-text-combine":{"text-combine":"horizontal"},".nehan-empha-dot-filled":{"text-emphasis-style":"filled dot"},".nehan-empha-dot-open":{"text-emphasis-style":"open dot"},".nehan-empha-circle-filled":{"text-emphasis-style":"filled circle"},".nehan-empha-circle-open":{"text-emphasis-style":"open circle"},".nehan-empha-double-circle-filled":{"text-emphasis-style":"filled double-circle"},".nehan-empha-double-circle-open":{"text-emphasis-style":"open double-circle"},".nehan-empha-triangle-filled":{"text-emphasis-style":"filled triangle"},".nehan-empha-triangle-open":{"text-emphasis-style":"open triangle"},".nehan-empha-sesame-filled":{"text-emphasis-style":"filled sesame"},".nehan-empha-sesame-open":{"text-emphasis-style":"open sesame"},".nehan-break-before":{"break-before":"always"},".nehan-break-after":{"break-after":"always"},".nehan-drop-caps::first-letter":{display:"inline-block","box-sizing":"content-box",measure:"1em",extent:"1em","float":"start","line-rate":1,"font-size":"4em"},".nehan-gap-start":{margin:{start:"1em"}},".nehan-gap-end":{margin:{end:"1em"}},".nehan-gap-after":{margin:{after:"1em"}},".nehan-gap-before":{margin:{before:"1em"}}},h={};h.extend=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a};var i={iter:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c])},iteri:function(a,b){for(var c=0,d=a.length;d>c;c++)b(c,a[c])},reviter:function(a,b){for(var c=a.length-1;c>=0;c--)b(a[c])},reviteri:function(a,b){for(var c=a.length-1;c>=0;c--)b(c,a[c])},forall:function(a,b){for(var c=0,d=a.length;d>c;c++)if(!b(a[c]))return!1;return!0},map:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b(a[d]);return c},mapi:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b(d,a[d]);return c},fold:function(a,b,c){for(var d=b,e=0,f=a.length;f>e;e++)d=c(d,a[e]);return d},filter:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)b(a[d])&&c.push(a[d]);return c},find:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b(e))return e}return null},revfind:function(a,b){for(var c=a.length-1;c>=0;c--){var d=a[c];if(b(d))return d}return null},indexOf:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b(e))return c}return-1},exists:function(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return!0;return!1},mem:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return!0;return!1},sum:function(a){return this.fold(a,0,function(a,b){return a+b})},minobj:function(a,b){var c=null,d=null;return this.iter(a,function(a){var e=b(a);(null===d||d>e)&&(c=a,d=e)}),c},maxobj:function(a,b){var c=null,d=null;return this.iter(a,function(a){var e=b(a);(null===d||e>d)&&(c=a,d=e)}),c},refcopy:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=a[c];return b},count:function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)b(a[d])&&c++;return c},create:function(a,b){var c=new Array(a);if("undefined"!=typeof b)for(var d=0;a>d;d++)c[d]=b;return c},first:function(a){return a[0]||null},last:function(a){var b=a.length;return 0===b?null:a[b-1]},zip:function(a,b){for(var c=[],d=0,e=Math.min(a.length,b.length);e>d;d++)c[d]=[a[d],b[d]];return c},zipObj:function(a,b){var c={};if(a.length!==b.length)throw"invalid args:List.zipObj";for(var d=0,e=a.length;e>d;d++)c[a[d]]=b[d];return c},reverse:function(a){var b=[];return this.reviter(a,function(a){b.push(a)}),b}},j={isEmpty:function(a){for(var b in a)return!1;return!0},map:function(a,b){var c={};for(var d in a)c[d]=b(a[d]);return c},each:function(a,b){for(var c in a)b(c,a[c])},iter:function(a,b){for(var c in a)b(c,a[c])}},k={trimHeadCRLF:function(a){return a.replace(/^\n+/,"")},trimFootCRLF:function(a){return a.replace(/\n+$/,"")},trimCRLF:function(a){return this.trimFootCRLF(this.trimHeadCRLF(a))},trim:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},cutQuote:function(a){return a.replace(/['\"]/g,"")},capitalize:function(a){return""===a?"":a.charAt(0).toUpperCase()+a.slice(1)},log:function(a,b){var c=b||10;return Math.log(a)/Math.log(c)},filenameConcat:function(a,b){return a=""===a?"":"/"===a.slice(-1)?a:a+"/",b=""===b?"":"/"===b[0]?b.substring(1,b.length):b,a+b},camelize:function(a){var b=this;return a.indexOf("-")<0?a:i.mapi(a.split("-"),function(a,c){return 0===a?c:b.capitalize(c)}).join("")}},l={convBase:function(a,b){if(0===a)return[0];for(var c=[],d=a;d>0;)c.unshift(d%b),d=Math.floor(d/b);return c}},m=function(){var a=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(b,c){var d="undefined"==typeof c?a:c;window.setTimeout(b,d)}}(),n={cssVenderPrefixes:["-moz","-webkit","-o","-ms"],cssCorders:["top-left","top-right","bottom-left","bottom-right"],cssBorderRadius:["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"],cssBoxDirs:["top","right","bottom","left"],cssBoxDirsLogical:["before","end","after","start"],cssBoxCornersLogical:["start-before","end-before","end-after","start-after"],css2dIndex:{1:[0,0],2:[0,1]},css4dIndex:{1:[0,0,0,0],2:[0,1,0,1],3:[0,1,2,1],4:[0,1,2,3]},space:"&nbsp;",clearFix:"<div style='clear:both'></div>"},o={toString:function(a){var b=[];for(var c in a)b.push(c+":"+a[c]);return b.join(";")},addNehanPrefix:function(a){return"nehan-"+a},addNehanHeaderPrefix:function(a){return"nehan-header-"+a},addNehanTocLinkPrefix:function(a){return"nehan-toc-link-"+a}},p={escape:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},unescape:function(a){var b=document.createElement("div");return b.innerHTML=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\r/g,"&#13;").replace(/\n/g,"&#10;"),b.textContent||b.innerText},attr:function(a){var b=[];for(var c in a)"undefined"!=typeof a[c]&&""!==a[c]&&b.push(c+"='"+this.escape(a[c]+"")+"'");return b==[]?"":b.join(" ")},tagWrap:function(a,b,c){return[this.tagStart(a,c||{}),b,this.tagEnd(a)].join("")},tagSingle:function(a,b){return"<"+a+" "+this.attr(b)+"/>"},tagStart:function(a,b){return"<"+a+" "+this.attr(b)+">"},tagEnd:function(a){return"</"+a+">"}},q={id:function(){return function(a){return a}},eq:function(a){return function(b){return a==b}},neq:function(a){return function(b){return a!=b}}},r={copy:function(a,b){a=a||{};for(var c in b)a[c]=b[c];return a},copy2:function(a,b){a=a||{};for(var c in b)"object"==typeof a[c]?this.copy2(a[c],b[c]):a[c]=b[c];return a},merge:function(a,b,c){a=a||{};for(var d in b)a[d]="undefined"==typeof c[d]?b[d]:c[d];return a}},s=function(){var a=function(a){return k.trim(String(a)).replace(/;/g,"").replace(/\n/g,"")},b=function(a){return a.indexOf(" ")<0?[a]:a.split(/\s+/)},c=function(a){return a.indexOf("/")<0?[a]:a.split("/")},d=function(a,b){var c={};if(a.length!==b.length)throw"invalid args:zip_obj";return i.iteri(a,function(a,d){c[d]=b[a]}),c},e=function(a){return n.css2dIndex[Math.min(a,2)]||[]},f=function(a){return n.css4dIndex[Math.min(a,4)]||[]},g=function(a,b){return i.map(b,function(b){return a[b]})},h=function(a){var b=e(a.length);return g(a,b)},j=function(a){var b=f(a.length);return g(a,b)},l=function(a){var b=n.cssBoxDirsLogical,c=j(a);return i.zipObj(b,c)},m=function(a){var b=n.cssBoxCornersLogical,c=j(a);return d(b,c)},o=function(a){return l(b(a))},p=function(a){var d=h(c(a)),e=i.map(d,function(a){return j(b(a))}),f=i.zip(e[0],e[1]);return m(f)},q=function(a){return a.indexOf("margin-")>=0||a.indexOf("padding-")>=0||a.indexOf("border-width-")>=0?a.split("-")[0]:a},r=function(b,c){switch(typeof c){case"function":case"object":case"boolean":return c}switch(c=a(c),b){case"border-width":return o(c);case"border-radius":return p(c);case"border-color":return o(c);case"border-style":return o(c);case"margin":return o(c);case"padding":return o(c);case"margin-before":case"padding-before":case"border-width-before":return{before:c,end:0,after:0,start:0};case"margin-end":case"padding-end":case"border-width-end":return{before:0,end:c,after:0,start:0};case"margin-after":case"padding-after":case"border-width-after":return{before:0,end:0,after:c,start:0};case"margin-start":case"padding-start":case"border-width-start":return{before:0,end:0,after:0,start:c};default:return c}};return{formatProp:function(a){return q(a)},formatValue:function(a,b){return r(a,b)}}}(),t=function(){function a(a){this.expr=this._normalize(a),this.left=this.op=this.right=null,this._parseExpr(this.expr)}var b=/[^=^~|$*\s]+/,c=["|=","~=","^=","$=","*=","="];return a.prototype={_normalize:function(a){return a.replace(/\[/g,"").replace(/\]/g,"")},_parseSymbol:function(a){var c=a.match(b);return c?c[0]:""},_parseOp:function(a){return i.find(c,function(b){return a.indexOf(b)>=0})},_parseExpr:function(a){this.left=this._parseSymbol(a),this.left&&(a=k.trim(a.slice(this.left.length))),this.op=this._parseOp(a),this.op&&(a=k.trim(a.slice(this.op.length)),this.right=k.cutQuote(k.trim(a)))},_testHasAttr:function(a){return null!==a.getMarkupAttr(this.left)},_testEqual:function(a){var b=a.getMarkupAttr(this.left);return b===this.right},_testCaretEqual:function(a){var b=a.getMarkupAttr(this.left),c=new RegExp("^"+this.right);return c.test(b)},_testDollarEqual:function(a){var b=a.getMarkupAttr(this.left),c=new RegExp(this.right+"$");return c.test(b)},_testTildeEqual:function(a){var b=a.getMarkupAttr(this.left),c=b?b.split(/\s+/):[];return i.exists(c,q.eq(this.right))},_testPipeEqual:function(a){var b=a.getMarkupAttr(this.left);return b?b==this.right||b.indexOf(this.right+"-")>=0:!1},_testStarEqual:function(a){var b=a.getMarkupAttr(this.left);return b.indexOf(this.right)>=0},_testOp:function(a){switch(this.op){case"=":return this._testEqual(a);case"^=":return this._testCaretEqual(a);case"$=":return this._testDollarEqual(a);case"|=":return this._testPipeEqual(a);case"~=":return this._testTildeEqual(a);case"*=":return this._testStarEqual(a)}throw"undefined operation:"+this.op},test:function(a){return this.op&&this.left&&this.right?this._testOp(a):this.left?this._testHasAttr(a):!1}},a}(),u=function(){function a(a){this.name=this._normalize(a)}return a.prototype={hasPseudoElement:function(){return"before"===this.name||"after"===this.name||"first-letter"===this.name||"first-line"===this.name},test:function(a){switch(this.name){case"before":return!0;case"after":return!0;case"first-letter":return!a.isMarkupEmpty();case"first-line":return!a.isMarkupEmpty();case"first-child":return a.isFirstChild();case"last-child":return a.isLastChild();case"first-of-type":return a.isFirstOfType();case"last-of-type":return a.isLastOfType();case"only-child":return a.isOnlyChild();case"only-of-type":return a.isOnlyOfType();case"empty":return a.isMarkupEmpty();case"root":return a.isRoot()}return!1},_normalize:function(a){return a.replace(/:+/g,"")}},a}(),v=function(){function a(a){this.name=a.name||null,this.nameRex=a.nameRex||null,this.id=a.id||null,this.classes=a.classes||[],this.attrs=a.attrs||[],this.pseudo=a.pseudo||null}return a.prototype={test:function(a){return null===a?!1:this.name&&!this.testName(a.getMarkupName())?!1:this.nameRex&&!this.testNameRex(a.getMarkupName())?!1:this.classes.length>0&&!this.testClassNames(a.getMarkupClasses())?!1:this.id&&a.getMarkupId()!=this.id?!1:this.attrs.length>0&&!this._testAttrs(a)?!1:this.pseudo&&!this.pseudo.test(a)?!1:!0},testName:function(a){return null===this.name?!1:"*"===this.name?!0:a===this.name},testNameRex:function(a){return null===this.nameRex?!1:this.nameRex.test(a)},testClassNames:function(a){return i.forall(this.classes,function(b){return i.exists(a,q.eq(b))})},getNameSpec:function(){return this.nameRex?1:null===this.name||"*"===this.name?0:1},getIdSpec:function(){return this.id?1:0},getClassSpec:function(){return this.classes.length},getAttrSpec:function(){return this.attrs.length},getPseudoClassSpec:function(){return this.pseudo?this.pseudo.hasPseudoElement()?0:1:0},_testAttrs:function(a){return i.forall(this.attrs,function(b){return b.test(a)})}},a}(),w=function(){function a(a){this.buff=this._normalize(a)}var b=/^[\w-_\*!\?]+/,c=/^\/[^\/]+\//,d=/^#[\w-_]+/,e=/^\.[\w-_]+/,f=/^\[[^\]]+\]/,g=/^:{1,2}[\w-_]+/;return a.prototype={getTokens:function(){for(var a=[];""!==this.buff;){var b=this._getNextToken();if(null===b)break;a.push(b)}return a},_getNextToken:function(){if(this.buff=k.trim(this.buff),""===this.buff)return null;var a=this.buff.charAt(0);switch(a){case"+":case"~":case">":return this._stepBuff(1),a;default:return this._getTypeSelector()}throw"invalid selector:["+this.buff+"]"},_normalize:function(a){return k.trim(a).replace(/\s+/g," ")},_stepBuff:function(a){this.buff=k.trim(this.buff.slice(a))},_getByRex:function(a){var b=null,c=this.buff.match(a);return c&&(b=c[0],this._stepBuff(b.length)),b},_getTypeSelector:function(){var a=this._getName(),b=null===a?this._getNameRex():null,c=this._getId(),d=this._getClasses(),e=this._getAttrs(),f=this._getPseudo();return new v({name:a,nameRex:b,id:c,classes:d,attrs:e,pseudo:f})},_getName:function(){return this._getByRex(b)},_getNameRex:function(){var a=this._getByRex(c);return null===a?null:new RegExp(a.replace(/[\/]/g,""))},_getId:function(){var a=this._getByRex(d);return a?a.substring(1):null},_getClasses:function(){for(var a=[];;){var b=this._getClass();if(null===b)break;a.push(b)}return a},_getClass:function(){var a=this._getByRex(e);return a?a.substring(1):null},_getAttrs:function(){for(var a=[];;){var b=this._getByRex(f);if(null===b)break;a.push(new t(b))}return a},_getPseudo:function(){var a=this._getByRex(g);return a?new u(a):null}},a}(),x=function(){var a=function(a,b){for(var c=a.parent;null!==c;){if(b.test(c))return c;c=c.parent}return null},b=function(a,b){var c=a.parent;return null===c?null:b.test(c)?c:null},c=function(a,b){var c=a.getChildIndex(),d=a.getParentNthChild(c-1)||null;return d&&b.test(d)?d:null},d=function(a,b){for(var c=a.getChildIndex(),d=0;c>d;d++){var e=a.getParentNthChild(d);if(e&&b.test(e))return e}return null};return{accept:function(e,f){if(0===f.length)throw"selector syntax error:"+src;for(var g,h,i,j,k=f.length-1,l=function(){return 0>k?null:f[k--]},m=function(){k++};k>=0;){if(g=l(),g instanceof v==!1)throw"selector syntax error:"+src;if(!g.test(e))return!1;if(h=l(),null===h)return!0;if(h instanceof v)i=h,j=" ";else if("string"==typeof h&&(j=h,i=l(),null===i||i instanceof v==!1))throw"selector syntax error:"+src;switch(j){case" ":e=a(e,i);break;case">":e=b(e,i);break;case"+":e=c(e,i);break;case"~":e=d(e,i);break;default:throw"selector syntax error:invalid combinator("+j+")"}if(null===e)return!1;m()}return!0}}}(),y=function(){function a(a,b){this.key=this._normalizeKey(a),this.value=this._formatValue(b),this.elements=this._getSelectorElements(this.key),this.spec=this._countSpec(this.elements)}return a.prototype={test:function(a){return x.accept(a,this.elements)},testPseudoElement:function(a,b){return this.hasPseudoElementName(b)&&this.test(a)},updateValue:function(a){for(var b in a){var c=s.formatValue(b,a[b]),d=s.formatProp(b),e=this.value[d]||null;null===e?this.value[d]=c:"object"==typeof e&&"object"==typeof c?r.copy(e,c):e=c}},getKey:function(){return this.key},getValue:function(){return this.value},getSpec:function(){return this.spec},hasPseudoElement:function(){return this.key.indexOf("::")>=0},hasPseudoElementName:function(a){return this.key.indexOf("::"+a)>=0},_countSpec:function(a){var b=0,c=0,d=0;return i.iter(a,function(a){a instanceof v&&(b+=a.getIdSpec(),c+=a.getClassSpec()+a.getPseudoClassSpec()+a.getAttrSpec(),d+=a.getNameSpec())}),parseInt([b,c,d].join(""),10)},_getSelectorElements:function(a){var b=new w(a);return b.getTokens()},_normalizeKey:function(a){return a=a instanceof RegExp?"/"+a.source+"/":a,k.trim(a).toLowerCase().replace(/\s+/g," ")},_formatValue:function(a){var b={};for(var c in a){var d=s.formatProp(c),e=s.formatValue(c,a[c]);b[d]=e}return b}},a}(),z=function(){var a=[],b=[],c=function(){a.sort(function(a,b){return a.spec-b.spec})},d=function(){b.sort(function(a,b){return a.spec-b.spec})},e=function(a){return a.indexOf("::")>=0},f=function(c){var d=e(c)?b:a;return i.find(d,function(a){return a.getKey()===c})},h=function(a,b){var c=g[a];r.copy(c,b);var d=f(a);d.updateValue(c)},k=function(c,d){var e=new y(c,d);return e.hasPseudoElement()?b.push(e):a.push(e),e},l=function(b){return i.fold(a,{},function(a,c){return c.test(b)?r.copy(a,c.getValue()):a})},m=function(a,c){return i.fold(b,{},function(b,d){return d.testPseudoElement(a,c)?r.copy(b,d.getValue()):b})},n=function(a,b){if(g[a])return void h(a,b);k(a,b);var e=k(a,b);g[a]=e.getValue(),e.hasPseudoElement()?d():c()},o=function(){j.iter(g,function(a,b){k(a,b)}),c(),d()};return o(),{setValue:function(a,b){n(a,b)},setValues:function(a){for(var b in a)n(b,a[b])},getValue:function(a){return l(a)},getValuePe:function(a,b){return m(a,b)}}}(),A=function(){var a=function(a,b){for(var c=function(){return a.charAt(0)},d=function(b){a=a.substring(b)},e=function(b){var c=-1;return i.iter(b,function(b){var d=a.indexOf(b,1);(0>c||c>d)&&(c=d)}),(c>=0?a.substring(0,c):a).toLowerCase()},f=function(b){var c=a.indexOf(b,1);return c>=1?a.substring(1,c):a},g=function(g){if(""===a)return void(g&&(b[g]=!0));var h,i=c();if(" "===i)d(1),arguments.callee(g);else if("="===i){if(d(1),a.length>0){var j=c();'"'===j||"'"===j?(h=f(j),d(h.length+2)):(h=e([" "]),d(h.length)),b[g]=h}}else g?b[g]=!0:(g=e([" ","="]),d(g.length),arguments.callee(g))};""!==a;)g();return b},b=function(a){return a.replace(/<[\S]+/,"").replace(/^\s+/,"").replace("/>","").replace(">","").replace(/\s+$/,"").replace(/\n/g,"").replace(/[　|\s]+/g," ").replace(/\s+=/g,"=").replace(/=\s+/g,"=")};return{parse:function(c){return c=b(c),a(c,{})}}}(),B=function(){function a(a){var b=A.parse(a);this.classes=this._parseClasses(b),this.attrs=this._parseAttrs(b,this.classes),this.dataset=this._parseDataset(b)}var b=function(a){return k.camelize(a.slice(5))};return a.prototype={hasAttr:function(){return"undefined"!=typeof this.attrs.name},hasClass:function(a){return i.exists(this.classes,q.eq(a))},addClass:function(a){return a=a.indexOf("nehan-")<0?"nehan-"+a:a,this.hasClass(a)||(this.classes.push(a),this.setAttr("class",[this.getAttr("class"),a].join(" "))),this.classes},removeClass:function(a){return this.classes=i.filter(this.classes,function(b){return b!=a}),this.setAttr("class",this.classes.join(" ")),this.classes},getAttr:function(a,b){return b="undefined"==typeof b?null:b,"undefined"==typeof this.attrs[a]?b:this.attrs[a]},getData:function(a,b){return b="undefined"==typeof b?null:b,"undefined"==typeof this.dataset[a]?b:this.dataset[a]},getClassesRaw:function(){return i.map(this.classes,function(a){return a.replace("nehan-","")})},setAttr:function(a,c){0===a.indexOf("data-")?this.setData(b(a),c):this.attrs[a]=c},setData:function(a,b){this.dataset[a]=b},_parseClasses:function(a){var b=a["class"]||"";b=k.trim(b.replace(/\s+/g," "));var c=""===b?[]:b.split(/\s+/);return i.map(c,function(a){return a.indexOf("nehan-")<0?"nehan-"+a:a})},_parseAttrs:function(a,b){var c={};return j.iter(a,function(a,d){"id"===a?c[a]=0===d.indexOf("nehan-")?d:"nehan-"+d:"class"===a?c[a]=b.join(" "):a.indexOf("data-")<0&&(c[a]=d)}),c},_parseDataset:function(a){var c={};for(var d in a)0===d.indexOf("data-")&&(c[b(d)]=a[d]);return c}},a}(),C=function(){function a(a,b){this._type="tag",this.src=a,this.content=b||"",this.name=this._parseName(this.src),this.attrs=new B(this.src)}return a.prototype={clone:function(){return new a(this.src,this.content)},setContent:function(a){this._fixed||(this.content=a)},setContentImmutable:function(a){this._fixed=a},setAlias:function(a){this.alias=a},setAttr:function(a,b){this.attrs.setAttr(a,b)},setData:function(a,b){this.attrs.setData(a,b)},addClass:function(a){this.attrs.addClass(a)},removeClass:function(a){this.attrs.removeClass(a)},getId:function(){return this.attrs.id},getClasses:function(){return this.attrs.classes},getClassesRaw:function(){return this.attrs.getClassesRaw()
},getName:function(){return this.alias||this.name},getAttr:function(a,b){return this.attrs.getAttr(a,b)},getData:function(a,b){return this.attrs.getData(a,b)},getContent:function(){return this.content},getSrc:function(){return this.src},getWrapSrc:function(){return""===this.content?this.src:this.src+this.content+"</"+this.name+">"},hasClass:function(a){return this.attrs.hasClass(a)},hasAttr:function(a){return this.attrs.hasAttr(a)},isAnchorTag:function(){return"a"===this.name&&null!==this.getTagAttr("name")},isAnchorLinkTag:function(){var a=this.getTagAttr("href");return"a"===this.name&&a&&a.indexOf("#")>=0},isCloseTag:function(){return"/"===this.name.charAt(0)},isSingleTag:function(){return this._single||!1},isEmpty:function(){return""===this.content},_parseName:function(a){return a.replace(/</g,"").replace(/\/?>/g,"").split(/\s/)[0].toLowerCase()}},a}(),D={isTag:function(a){return"tag"===a._type},isText:function(a){return"char"===a._type||"word"===a._type||"tcy"===a._type||"ruby"===a._type},isChar:function(a){return"char"===a._type},isWord:function(a){return"word"===a._type},isTcy:function(a){return"tcy"===a._type},isNewLine:function(a){return a instanceof E&&a.isNewLineChar()},isWhiteSpace:function(a){return a instanceof E&&a.isWhiteSpaceChar()}},E=function(){function a(a,b){this.data=a,this._type="char",this.isRef=b||!1,this.isRef?this._setupRef(a):this._setupNormal(a.charCodeAt(0))}var b=["。","."],f=["、",","],g=["｢","「","『","【","［","（","《","〈","≪","＜","｛","{","[","("],h=["」","｣","』","】","］","）","》","〉","≫","＞","｝","}","]",")"],j=["ぁ","ぃ","ぅ","ぇ","ぉ","っ","ゃ","ゅ","ょ","ゎ","ァ","ィ","ゥ","ェ","ォ","ヵ","ヶ","ッ","ャ","ュ","ョ","ヮ"],k=["）","\\",")","」","】","〕","］","\\","]","。","』","＞","〉","》","、","．","\\",".",",","”","〟"],l=["（","\\","(","「","【","［","〔","\\","[","『","＜","〈","《","“","〝"];return a.prototype={getData:function(){return this.cnv||this.data},getCssPadding:function(a){var b=new db;return this.paddingStart&&b.setStart(a.style.flow,this.paddingStart),this.paddingEnd&&b.setEnd(a.style.flow,this.paddingEnd),b.getCss()},getCssVertGlyph:function(){var a={},b=this.isPaddingEnable();return a["margin-left"]="auto",a["margin-right"]="auto",this.isKakkoStart()?b||(a["margin-top"]="-0.5em"):(this.getVertScale()<1&&(a.height="0.5em"),b&&(a["margin-bottom"]="0.5em")),a},getCssVertImgChar:function(a){var b={},c=a.style.getFontSize();return b.display="block",b.width=c+"px",b.height=this.getVertHeight(c)+"px",b["margin-left"]="auto",b["margin-right"]="auto",this.isPaddingEnable()&&r.copy(b,this.getCssPadding(a)),b},getCssVertRotateCharIE:function(a){var b={},c=a.style.getFontSize();return b["css-float"]="left",b["writing-mode"]="tb-rl",b["padding-left"]=Math.round(c/2)+"px",b["line-height"]=c+"px",b},getCssVertEmphaTarget:function(){var a={};return a},getCssVertEmphaText:function(a){var b={},c=a.style.getFontSize();return b.display="inline-block",b.width=c+"px",b.height=c+"px",b},getCssHoriEmphaTarget:function(){var a={};return a},getCssHoriEmphaText:function(){var a={};return a},getCssVertLetterSpacing:function(a){var b={};return b["margin-bottom"]=a.letterSpacing+"px",b},getCssVertHalfSpaceChar:function(a){var b={},c=a.style.getFontSize(),d=Math.round(c/2);return b.height=d+"px",b["line-height"]=d+"px",b},getCssVertSmallKana:function(){var a={};return a.position="relative",a.top="-0.1em",a.right="-0.12em",a.height=this.bodySize+"px",a["line-height"]=this.bodySize+"px",a.clear="both",a},getHoriScale:function(){return this.hscale?this.hscale:1},getVertScale:function(){return this.vscale?this.vscale:1},getVertHeight:function(a){var b=this.getVertScale();return 1===b?a:Math.round(a*b)},hasMetrics:function(){return"undefined"!=typeof this.bodySize},getAdvance:function(a,b){return this.bodySize+this.getPaddingSize()+(b||0)},getPaddingSize:function(){return(this.paddingStart||0)+(this.paddingEnd||0)},getCharCount:function(){return" "===this.data||"	"===this.data||"　"===this.data?0:1},setMetrics:function(a,b){var c=a.isTextVertical(),d=c?this.getVertScale():this.getHoriScale();this.bodySize=1!=d?Math.round(b.size*d):b.size,this.spaceRateStart&&(this.paddingStart=Math.round(this.spaceRateStart*b.size)),this.spaceRateEnd&&(this.paddingEnd=Math.round(this.spaceRateEnd*b.size)),this.img&&"tenten"===this.img&&(this.bodySize=b.size),c||this.isRef||!this.isHankaku()||(this.bodySize=Math.round(b.size/2))},_setImg:function(a,b,c){this.img=a,this.vscale=b||1,this.hscale=c||this.vscale},_setCnv:function(a,b,c){this.cnv=a,this.vscale=b||1,this.hscale=c||this.vscale},_setRotate:function(a){this.rotate=a},_setRotateOrImg:function(a,b,c){return e.isTransformEnable?void this._setRotate(a):void this._setImg(b,c)},_setupRef:function(a){switch(a){case"&lt;":this._setRotateOrImg(90,"kakko7",.5);break;case"&gt;":this._setRotateOrImg(90,"kakko8",.5)}},_setupNormal:function(a){switch(a){case 32:this._setCnv("&nbsp;",.5,.5);break;case 12300:this._setImg("kakko1",.5);break;case 65378:this._setImg("kakko1",.5);break;case 12301:this._setImg("kakko2",.5);break;case 65379:this._setImg("kakko2",.5);break;case 12302:this._setImg("kakko3",.5);break;case 12303:this._setImg("kakko4",.5);break;case 65288:this._setImg("kakko5",.5);break;case 40:this._setImg("kakko5",.5);break;case 65371:this._setImg("kakko5",.5);break;case 123:this._setImg("kakko5",.5);break;case 65289:this._setImg("kakko6",.5);break;case 41:this._setImg("kakko6",.5);break;case 65373:this._setImg("kakko6",.5);break;case 125:this._setImg("kakko6",.5);break;case 65308:this._setImg("kakko7",.5);break;case 12296:this._setImg("kakko7",.5);break;case 65310:this._setImg("kakko8",.5);break;case 12297:this._setImg("kakko8",.5);break;case 12298:this._setImg("kakko9",.5);break;case 8810:this._setImg("kakko9",.5);break;case 12299:this._setImg("kakko10",.5);break;case 8811:this._setImg("kakko10",.5);break;case 65339:this._setImg("kakko11",.5);break;case 12308:this._setImg("kakko11",.5);break;case 91:this._setImg("kakko11",.5);break;case 65341:this._setImg("kakko12",.5);break;case 12309:this._setImg("kakko12",.5);break;case 93:this._setImg("kakko12",.5);break;case 12304:this._setImg("kakko17",.5);break;case 12305:this._setImg("kakko18",.5);break;case 65306:this._setImg("tenten",1,1);break;case 58:this._setImg("tenten",1,1);break;case 12290:this._setImg("kuten",.5);break;case 65377:this._setImg("kuten",.5);break;case 65294:this._setImg("period",1);break;case 46:this._setImg("period",1);break;case 12289:this._setImg("touten",.5);break;case 65380:this._setImg("touten",.5);break;case 44:this._setImg("touten",.5);break;case 65292:this._setImg("touten",.5);break;case 65374:this._setImg("kara",1);break;case 12316:this._setImg("kara",1);break;case 8230:this._setImg("mmm",1);break;case 8229:this._setImg("mm",1);break;case 12317:this._setImg("dmn1",1);break;case 12319:this._setImg("dmn2",1);break;case 65309:this._setImg("equal",1);break;case 61:this._setImg("equal",1);break;case 8212:this._setRotate(90);break;case 12540:this._setImg("onbiki",1);break;case 45:this._setCnv("&#65372;");break;case 8213:case 65293:case 9472:this._setCnv("&#8212;"),this._setRotate(90);break;case 8593:this._setCnv("&#8594;");break;case 8594:this._setCnv("&#8595;");break;case 8658:this._setCnv("&#8595;");break;case 8595:this._setCnv("&#8592;");break;case 8592:this._setCnv("&#8593;");break;case 8220:this._setRotate(90);break;case 8221:this._setRotate(90)}},isNewLineChar:function(){return"\n"===this.data},isSpaceChar:function(){return" "===this.data||"&nbsp;"===this.data||"	"===this.data},isWhiteSpaceChar:function(){return this.isNewLineChar()||this.isSpaceChar()},isImgChar:function(){return"undefined"!=typeof this.img},isCnvChar:function(){return"undefined"!=typeof this.cnv},isRotateChar:function(){return"undefined"!=typeof this.rotate},isCharRef:function(){return this.isRef},isHalfSpaceChar:function(){return this.isCnvChar()&&"&nbsp;"===this.cnv},isKerningChar:function(){return this.isKutenTouten()||this.isKakko()},getImgSrc:function(a){return[d.fontImgRoot,this.img,a+".png"].join("/")},isPaddingEnable:function(){return"undefined"!=typeof this.paddingStart||"undefined"!=typeof this.paddingEnd},isVertGlyphEnable:function(){return c.useVerticalGlyphIfEnable&&e.isVerticalGlyphEnable},isTenten:function(){return this.img&&"tenten"===this.img},isHeadNg:function(){return i.mem(k,this.data)},isTailNg:function(){return i.mem(l,this.data)},isSmallKana:function(){return i.mem(j,this.data)},isKakkoStart:function(){return i.mem(g,this.data)},isKakkoEnd:function(){return i.mem(h,this.data)},isKakko:function(){return this.isKakkoStart()||this.isKakkoEnd()},isKuten:function(){return i.mem(b,this.data)},isTouten:function(){return i.mem(f,this.data)},isKutenTouten:function(){return this.isKuten()||this.isTouten()},isZenkaku:function(){return"u"===escape(this.data).charAt(1)},isHankaku:function(){return!this.isZenkaku(this.data)}},a}(),F=function(){function a(a,b){this.data=a,this._type="word",this._devided=b||!1}return a.prototype={getCssVertTrans:function(a){var b={};return a.style.letterSpacing&&(b["letter-spacing"]=a.style.letterSpacing+"px"),b.width=a.style.getFontSize()+"px",b.height=this.bodySize+"px",b["margin-left"]="auto",b["margin-right"]="auto",b["font-family"]="monospace",b},getCssVertTransBody:function(){var a={};return a["font-family"]="monospace",a},getCssVertTransBodyTrident:function(a){var b={};b["font-family"]="monospace",b.width=a.style.getFontSize()+"px",b.height=this.bodySize+"px",b["transform-origin"]="50% 50%",b["line-height"]=this.bodySize+"px";var c=Math.floor((this.bodySize-a.style.getFontSize())/2);return c>0&&(b.transform="rotate(90deg) translate(-"+c+"px, 0)"),b},getCssVertTransIE:function(a){var b={},c=a.style.getFontSize();return b["font-family"]="monospace",b["css-float"]="left",b["writing-mode"]="tb-rl",b["letter-spacing"]=(a.style.letterSpacing||0)+"px",b["padding-left"]=Math.round(c/2)+"px",b["line-height"]=c+"px",b},getCharCount:function(){return 1},getAdvance:function(a,b){return this.bodySize+(b||0)*this.getLetterCount()},hasMetrics:function(){return"undefined"!=typeof this.bodySize},countUpper:function(){for(var a=0,b=0;b<this.data.length;b++)/[A-Z]/.test(this.data.charAt(b))&&a++;return a},setMetrics:function(a,b){return c.useStrictWordMetrics&&N.isEnable()?void(this.bodySize=N.getMeasure(b,this.data)):(this.bodySize=Math.round(this.data.length*b.size*.5),void(b.isBold()&&(this.bodySize+=Math.round(d.boldRate*this.bodySize))))},getLetterCount:function(){return this.data.length},setDevided:function(a){this._devided=a},isDevided:function(){return this._devided},cutMeasure:function(b,c){var d=Math.round(b/2),e=Math.round(this.bodySize/d),f=Math.round(c/d);if(f>e)return this;var g=this.data.substring(0,f),h=new a(g,!0);return this.data=this.data.slice(f),this.setDevided(!0),h}},a}(),G=function(){function a(a){this.data=a,this._type="tcy"}return a.prototype={getCharCount:function(){return 1},getAdvance:function(a,b){return this.bodySize+b},hasMetrics:function(){return"undefined"!=typeof this.bodySize},setMetrics:function(a,b){this.bodySize=b.size}},a}(),H=function(){function a(a,b){this._type="ruby",this.rbs=a,this.rt=b}return a.prototype={hasMetrics:function(){return"undefined"!=typeof this.advanceSize},getCharCount:function(){return this.rbs?this.rbs.length:0},getAdvance:function(){return this.advanceSize},getRbs:function(){return this.rbs},getRtString:function(){return this.rt?this.rt.getContent():""},getRtFontSize:function(){return this.rtFontSize},getCssHoriRuby:function(){var a={};return a.display="inline-block",a},getCssVertRt:function(){var a={};return a["css-float"]="left",a},getCssHoriRt:function(a){{var b={};Math.floor((a.style.getFontSize()-this.getRtFontSize())/3)}return b["font-size"]=this.getRtFontSize()+"px",b["line-height"]="1em",b},getCssVertRb:function(){var a={};return a["css-float"]="left",this.padding&&r.copy(a,this.padding.getCss()),a},getCssHoriRb:function(){var a={};return this.padding&&r.copy(a,this.padding.getCss()),a["text-align"]="center",a},setMetrics:function(a,b,c){this.rtFontSize=d.getRtFontSize(b.size);var e=i.fold(this.rbs,0,function(d,e){return e.setMetrics(a,b),d+e.getAdvance(a,c)}),f=this.rtFontSize*this.getRtString().length;if(this.advanceSize=e,f>e){var g=Math.ceil((f-e)/2);this.rbs.length>0&&(this.padding=new db,this.padding.setStart(a,g),this.padding.setEnd(a,g)),this.advanceSize+=g+g}}},a}(),I=function(){function a(a){this.value=String(a),this.red=parseInt(this.value.substring(0,2),16),this.green=parseInt(this.value.substring(2,4),16),this.blue=parseInt(this.value.substring(4,6),16)}return a.prototype={getRed:function(){return this.red},getGreen:function(){return this.green},getBlue:function(){return this.blue},getColorValue:function(){return this.value}},a}(),J=function(){function a(a){this.setValue(a)}return a.prototype={setValue:function(a){this.value=K.get(a)},getValue:function(){return this.value},getCssValue:function(){return"transparent"===this.value?this.value:"#"+this.value},getRgb:function(){return new I(this.value)},getCss:function(){var a={};return a.color=this.getCssValue(),a}},a}(),K=function(){var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4","indianred ":"cd5c5c","indigo ":"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},b=/^(?:[0-9a-f]{3}){1,2}$/;return{get:function(c){return c=c.replace(/#/g,"").toLowerCase(),b.test(c)?3===c.length?c[0]+c[0]+c[1]+c[1]+c[2]+c[2]:c:a[c]||c}}}(),L=function(){var a=[0,36,73,109,146,182,219,255],b=[0,85,170,255],c=function(a){var b=a.toString(16);return b.length<=1?"0"+b:b},d=function(a,b){return i.exists(b,q.eq(a))?a:i.minobj(b,function(b){return Math.abs(b-a)})};return{getColor:function(e){var f=d(e.getRed(),a),g=d(e.getGreen(),a),h=d(e.getBlue(),b);return[c(f),c(g),c(h)].join("")}}}(),M=function(){var a={"lower-alpha":["a","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],"upper-alpha":["A","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],"lower-roman":["i","i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],"upper-roman":["I","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],"lower-greek":["α","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],"upper-greek":["Α","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],"cjk-ideographic":["〇","一","二","三","四","五","六","七","八","九","十"],hiragana:["あ","あ","い","う","え","お","か","き","く","け","こ","さ","し","す","せ","そ","た","ち","つ","て","と","な","に","ぬ","ね","の","は","ひ","ふ","へ","ほ","ま","み","む","め","も","や","ゆ","よ","ら","り","る","れ","ろ","わ","ゐ","ゑ","を","ん"],"hiragana-iroha":["い","い","ろ","は","に","ほ","へ","と","ち","り","ぬ","る","を","わ","か","よ","た","れ","そ","つ","ね","な","ら","む","う","ゐ","の","お","く","や","ま","け","ふ","こ","え","て","あ","さ","き","ゆ","め","み","し","ゑ","ひ","も","せ","す"],katakana:["ア","ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ","ル","レ","ロ","ワ","ヰ","ヱ","ヲ","ン"],"katakana-iroha":["イ","イ","ロ","ハ","ニ","ホ","ヘ","ト","チ","リ","ヌ","ル","ヲ","ワ","カ","ヨ","タ","レ","ソ","ツ","ネ","ナ","ラ","ム","ウ","ヰ","ノ","オ","ク","ヤ","マ","ケ","フ","コ","エ","テ","ア","サ","キ","ユ","メ","ミ","シ","ヱ","ヒ","モ","セ","ス"]},b={"upper-latin":"upper-alpha","lower-latin":"lower-alpha"};return{getTableByName:function(c){return a[b[c]||c]},getBaseByName:function(a){var b=this.getTableByName(a);return b.length},getStringByName:function(a,b){for(var c=this.getTableByName(a),d=c.length,e=l.convBase(b,d),f="",g=0;g<e.length;g++){var h=e[g],i=0===g?e[g]:Math.min(h+1,d-1);f+=c[i]||""}return f}}}(),N=function(){var a=document.createElement("canvas");a.style.width=Math.max(d.width,d.height)+"px",a.style.height=d.maxFontSize+"px";var b;return a.getContext&&(b=a.getContext("2d"),b.textAlign="left"),{isEnable:function(){return b&&"undefined"!=typeof b.measureText},getMetrics:function(a,c){return b.font=a.toString(),b.measureText(c)},getMeasure:function(a,b){var c=this.getMetrics(a,b),e=Math.floor(d.vertWordSpaceRate*a.size);return c.width+e}}}(),O=function(){function a(a){this.type=a}var b={disc:"&#x2022;",circle:"&#x25CB;",square:"&#x25A0;"};return a.prototype={isDecimalList:function(){return"decimal"===this.type||"decimal-leading-zero"===this.type},isNoneList:function(){return"none"===this.type},isMarkList:function(){return"disc"===this.type||"circle"===this.type||"square"===this.type},isCountableList:function(){return!this.isNoneList()&&!this.isMarkList()},isHankaku:function(){return"lower-alpha"===this.type||"upper-alpha"===this.type||"lower-roman"===this.type||"upper-roman"===this.type||this.isDecimalList()},isZenkaku:function(){return!this.isHankaku()},_getMarkerDigitString:function(a){return"decimal"===this.type?a.toString(10):"decimal-leading-zero"===this.type?10>a?"0"+a.toString(10):a.toString(10):M.getStringByName(this.type,a)},getMarkerHtml:function(a){var b=this.getMarkerText(a);return this.isZenkaku()?p.tagWrap("span",b,{"class":"nehan-tcy"}):b},getMarkerText:function(a){if(this.isNoneList())return n.space;if(this.isMarkList())return b[this.type]||"";var c=this._getMarkerDigitString(a);return c+"."}},a}(),P=function(){function a(a){this.pos=a}return a.prototype={isOutside:function(){return"outside"===this.pos},isInside:function(){return"inside"===this.pos}},a}(),Q=function(){function a(a){this.image=a}return a.prototype={getMarkerHtml:function(){var a=this.image.url,b=this.image.width||d.fontSize,c=this.image.height||d.fontSize;return p.tagSingle("img",{src:a,"class":"nehan-list-image",width:b,height:c})}},a}(),R=function(){function a(a){this.type=new O(a.type||"none"),this.position=new P(a.position||"outside"),this.image="none"!==a.image?new Q(a.image):null}return a.prototype={isMultiCol:function(){return this.position.isOutside()},isInside:function(){return this.position.isInside()},isImageList:function(){return null!==this.image},getMarkerHtml:function(a){return null!==this.image?this.image.getMarkerHtml(a):this.type.getMarkerHtml(a)}},a}(),S=function(){function a(a){this.dir=a}return a.prototype={init:function(a){this.dir=a},isHorizontal:function(){return"lr"===this.dir||"rl"===this.dir},isVertical:function(){return"tb"===this.dir},isLeftToRight:function(){return"lr"===this.dir},isRightToLeft:function(){return"rl"===this.dir}},a}(),T=function(){function a(a){S.call(this,a)}return h.extend(a,S),a.prototype.flip=function(){switch(this.dir){case"lr":case"rl":return"tb";case"tb":return d.getVertBlockdir();default:return""}},a.prototype.getCss=function(){var a={};return this.isHorizontal()?a["css-float"]="lr"===this.dir?"left":"right":this.isVertical()&&(a["css-float"]="lr"===this.dir?"left":"right"),a},a.prototype.getPropBefore=function(){switch(this.dir){case"lr":return"left";case"rl":return"right";case"tb":return"top";default:return""}},a.prototype.getPropAfter=function(){switch(this.dir){case"lr":return"right";case"rl":return"left";case"tb":return"bottom";default:return""}},a}(),U=function(){function a(a){S.call(this,a)}return h.extend(a,S),a.prototype.getPropStart=function(){switch(this.dir){case"lr":return"left";case"rl":return"right";case"tb":return"top";default:return""}},a.prototype.getPropEnd=function(){switch(this.dir){case"lr":return"right";case"rl":return"left";case"tb":return"bottom";default:return""}},a}(),V=function(){function a(a,b,c){this.inflow=new U(a),this.blockflow=new T(b,c)}return a.prototype={isTextLineFirst:function(){return this.isTextVertical()&&this.blockflow.isLeftToRight()?!0:!1},isBlockflowVertical:function(){return this.blockflow.isVertical()},isTextVertical:function(){return this.inflow.isVertical()},isTextHorizontal:function(){return this.inflow.isHorizontal()},getCss:function(){var a={};return r.copy(a,this.blockflow.getCss()),a},getName:function(){return[this.inflow.dir,this.blockflow.dir].join("-")},getTextHorizontalDir:function(){return this.isTextHorizontal()?this.inflow.dir:""},getProp:function(a){switch(a){case"start":return this.getPropStart();case"end":return this.getPropEnd();case"before":return this.getPropBefore();case"after":return this.getPropAfter()}},getPropStart:function(){return this.inflow.getPropStart()},getPropEnd:function(){return this.inflow.getPropEnd()},getPropBefore:function(){return this.blockflow.getPropBefore()},getPropAfter:function(){return this.blockflow.getPropAfter()},getPropExtent:function(){return this.isTextVertical()?"width":"height"},getPropMeasure:function(){return this.isTextVertical()?"height":"width"},getPropWidth:function(){return this.isTextVertical()?"extent":"measure"},getPropHeight:function(){return this.isTextVertical()?"measure":"extent"},getFlipFlow:function(){return this.isTextVertical()?d.getStdHoriFlow():d.getStdVertFlow()},getBoxSize:function(a,b){var c=new lb(0,0);return c[this.getPropMeasure()]=a,c[this.getPropExtent()]=b,c}},a}(),W={"tb-rl":new V("tb","rl"),"tb-lr":new V("tb","lr"),"lr-tb":new V("lr","tb"),"rl-tb":new V("rl","tb"),get:function(a,b){return this.getByName([a,b].join("-"))},getByName:function(a){return this[a]||null}},X={iter:function(a,b){i.iter(n.cssBoxDirs,function(c){a[c]&&b(c,a[c])})},map:function(a,b){return a instanceof Array?i.map(a,b):"object"==typeof a?j.map(a,b):b(a)},setValue:function(a,b,c){return"undefined"!=typeof c.start&&this.setStart(a,b,c.start),"undefined"!=typeof c.end&&this.setEnd(a,b,c.end),"undefined"!=typeof c.before&&this.setBefore(a,b,c.before),"undefined"!=typeof c.after&&this.setAfter(a,b,c.after),a},setBefore:function(a,b,c){a[b.getPropBefore()]=c},setAfter:function(a,b,c){a[b.getPropAfter()]=c},setStart:function(a,b,c){a[b.getPropStart()]=c},setEnd:function(a,b,c){a[b.getPropEnd()]=c}},Y={sortCornerDirection:function(a,b){var c={top:0,bottom:1,left:2,right:3};return[a,b].sort(function(a,b){return c[a]-c[b]})},getCornerName:function(a,b){var c=this.sortCornerDirection(a,b);return[c[0],k.capitalize(c[1])].join("")}},Z=function(){function a(a){this.size=a}return a.prototype={isBold:function(){return this.weight&&"normal"!==this.weight&&"lighter"!==this.weight},toString:function(){return[this.weight||"normal",this.style||"normal",this.size+"px",this.family||"monospace"].join(" ")},getCss:function(){var a={};return this.size&&(a["font-size"]=this.size+"px"),this.weight&&(a["font-weight"]=this.weight),this.style&&(a["font-style"]=this.style),this.family&&(a["font-family"]=this.family),a}},a}(),$=function(){function a(a){this._type=a,this.top=0,this.right=0,this.bottom=0,this.left=0}return a.prototype={clear:function(){this.top=0,this.right=0,this.bottom=0,this.left=0},clone:function(){var b=new a(this._type);return b.top=this.top,b.right=this.right,b.bottom=this.bottom,b.left=this.left,b},getDirProp:function(a){return[this._type,a].join("-")},getCss:function(){var a={},b=this;return i.iter(["top","right","bottom","left"],function(c){var d=b[c];d>0&&(a[b.getDirProp(c)]=b[c]+"px")}),a},getWidth:function(){return this.left+this.right},getHeight:function(){return this.top+this.bottom},getMeasureSize:function(a){return a.isTextVertical()?this.getHeight():this.getWidth()},getExtentSize:function(a){return a.isBlockflowVertical()?this.getHeight():this.getWidth()},setSize:function(a,b){X.setValue(this,a,b)},setStart:function(a,b){this[a.getPropStart()]=b},setEnd:function(a,b){this[a.getPropEnd()]=b},setBefore:function(a,b){this[a.getPropBefore()]=b},setAfter:function(a,b){this[a.getPropAfter()]=b},getStart:function(a){return this[a.getPropStart()]},getEnd:function(a){return this[a.getPropEnd()]},getBefore:function(a){return this[a.getPropBefore()]},getAfter:function(a){return this[a.getPropAfter()]}},a}(),_=function(){function a(){this.hori=0,this.vert=0}return a.prototype={setSize:function(a){this.hori=a[0],this.vert=a[1]},getCssValueHori:function(){return this.hori+"px"},getCssValueVert:function(){return this.vert+"px"}},a}(),ab=function(){function a(){this.topLeft=new _,this.topRight=new _,this.bottomRight=new _,this.bottomLeft=new _}return a.prototype={getArray:function(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]},getCssValueHori:function(){return i.map(this.getArray(),function(a){return a.getCssValueHori()}).join(" ")},getCssValueVert:function(){return i.map(this.getArray(),function(a){return a.getCssValueVert()}).join(" ")},getCssValue:function(){return[this.getCssValueHori(),this.getCssValueVert()].join("/")},getCss:function(){var a={},b=this.getCssValue();return a["border-radius"]=b,i.iter(n.cssVenderPrefixes,function(c){var d=[c,"border-radius"].join("-");a[d]=b}),a},getCorner:function(a,b){var c=Y.getCornerName(a,b);return this[c]},setSize:function(a,b){"undefined"!=typeof b["start-before"]&&this.setStartBefore(a,b["start-before"]),"undefined"!=typeof b["start-after"]&&this.setStartAfter(a,b["start-after"]),"undefined"!=typeof b["end-before"]&&this.setEndBefore(a,b["end-before"]),"undefined"!=typeof b["end-after"]&&this.setEndAfter(a,b["end-after"])},setStartBefore:function(a,b){var c=this.getCorner(a.getPropStart(),a.getPropBefore());c.setSize(b)},setStartAfter:function(a,b){var c=this.getCorner(a.getPropStart(),a.getPropAfter());c.setSize(b)},setEndBefore:function(a,b){var c=this.getCorner(a.getPropEnd(),a.getPropBefore());c.setSize(b)},setEndAfter:function(a,b){var c=this.getCorner(a.getPropEnd(),a.getPropAfter());c.setSize(b)},clearBefore:function(a){this.setStartBefore(a,[0,0]),this.setEndBefore(a,[0,0])},clearAfter:function(a){this.setStartAfter(a,[0,0]),this.setEndAfter(a,[0,0])}},a}(),bb=function(){function a(){}return a.prototype={setColor:function(a,b){var c=this;X.setValue(this,a,b),X.iter(this,function(a,b){c[a]=new J(b)})},getCss:function(){var a={};return X.iter(this,function(b,c){var d=["border",b,"color"].join("-");a[d]=c.getCssValue()}),a}},a}(),cb=function(){function a(){}return a.prototype={setStyle:function(a,b){X.setValue(this,a,b)},getCss:function(){var a={};return X.iter(this,function(b,c){var d=["border",b,"style"].join("-");a[d]=c}),a}},a}(),db=function(){function a(){$.call(this,"padding")}return h.extend(a,$),a}(),eb=function(){function a(){$.call(this,"margin")}return h.extend(a,$),a}(),fb=function(){function a(){$.call(this,"border")}return h.extend(a,$),a.prototype.clearBefore=function(a){this.setBefore(a,0),this.radius&&this.radius.clearBefore(a)},a.prototype.clearAfter=function(a){this.setAfter(a,0),this.radius&&this.radius.clearAfter(a)},a.prototype.getDirProp=function(a){return["border",a,"width"].join("-")},a.prototype.setRadius=function(a,b){this.radius=new ab,this.radius.setSize(a,b)},a.prototype.setColor=function(a,b){this.color=new bb,this.color.setColor(a,b)},a.prototype.setStyle=function(a,b){this.style=new cb,this.style.setStyle(a,b)},a.prototype.getCss=function(){var a=$.prototype.getCss.call(this);return this.radius&&r.copy(a,this.radius.getCss()),this.color&&r.copy(a,this.color.getCss()),this.style&&r.copy(a,this.style.getCss()),a},a}(),gb=function(){function a(a){this.value=a||"none"}var b="filled dot",c={"filled dot":"&#x2022;","open dot":"&#x25e6;","filled circle":"&#x25cf;","open circle":"&#x25cb;","filled double-circle":"&#x25c9;","open double-circle":"&#x25ce;","filled triangle":"&#x25b2;","open triangle":"&#x25b3;","filled sesame":"&#xfe45;","open sesame":"&#xfe46;"};return a.prototype={isEnable:function(){return"none"!=this.value},setValue:function(a){this.value=a},getText:function(){return c[this.value]||this.value||c[b]},getCss:function(){var a={};return a}},a}(),hb=function(){function a(a){r.merge(this,{hori:"over",vert:"right"},a||{})}return a.prototype={isEmphaFirst:function(){return"over"===this.hori||"left"===this.vert},getCss:function(){var a={};return a}},a}(),ib=function(){function a(a){a=a||{},this.style=a.style||new gb,this.pos=a.pos||new hb,this.color=a.color||new J(d.fontColor)}return a.prototype={isEnable:function(){return this.style&&this.style.isEnable()},isEmphaStart:function(){return this.pos?this.pos.isEmphaStart():!0},getText:function(){return this.style?this.style.getText():""},getExtent:function(a){return 3*a},getCssVertEmphaWrap:function(a,b){var c={},d=a.style.getFontSize();return c["text-align"]="left",c.width=this.getExtent(d)+"px",c.height=b.getAdvance(a.style.flow,a.style.letterSpacing||0)+"px",c},getCssHoriEmphaWrap:function(a,b){var c={},d=a.style.getFontSize();return c.display="inline-block",c.width=b.getAdvance(a.style.flow,a.style.letterSpacing)+"px",c.height=this.getExtent(d)+"px",c}},a}(),jb=function(){function a(a){this.address=this._normalize(a||"")}return a.prototype={_normalize:function(a){return a.replace(/\s/g,"")},getAddress:function(){return this.address},getAnchorName:function(){var a=this.address.indexOf("#");if(0>a)return"";var b=this.address.substring(a+1);return b.length>0?b:""}},a}(),kb=function(){function a(a){a=a||{},this.padding=a.padding||new db,this.border=a.border||new fb,this.margin=a.margin||new eb}return a.prototype={clone:function(){var b=new a;return b.padding=this.padding.clone(),b.border=this.border.clone(),b.margin=this.margin.clone(),b},clear:function(){this.padding.clear(),this.border.clear(),this.margin.clear()},getCss:function(){var a={};return r.copy(a,this.padding.getCss()),r.copy(a,this.border.getCss()),r.copy(a,this.margin.getCss()),a},getWidth:function(){var a=0;return a+=this.padding.getWidth(),a+=this.border.getWidth(),a+=this.margin.getWidth()
},getHeight:function(){var a=0;return a+=this.padding.getHeight(),a+=this.border.getHeight(),a+=this.margin.getHeight()},getMeasureSize:function(a){var b=0;return b+=this.padding.getMeasureSize(a),b+=this.border.getMeasureSize(a),b+=this.margin.getMeasureSize(a)},getExtentSize:function(a){var b=0;return b+=this.padding.getExtentSize(a),b+=this.margin.getExtentSize(a),b+=this.border.getExtentSize(a)},getInnerMeasureSize:function(a){var b=0;return b+=this.padding.getMeasureSize(a),b+=this.border.getMeasureSize(a)},getInnerExtentSize:function(a){var b=0;return b+=this.padding.getExtentSize(a),b+=this.border.getExtentSize(a)},setAll:function(a,b,c){this[a].setAll(b,c)},setBorderRadius:function(a,b){this.border.setRadius(a,b)},setBorderColor:function(a,b){this.border.setColor(a,b)},setBorderStyle:function(a,b){this.border.setStyle(a,b)},clearBorderStart:function(a){this.border.clearStart(a)},clearBorderBefore:function(a){this.border.clearBefore(a)},clearBorderAfter:function(a){this.border.clearAfter(a)}},a}(),lb=function(){function a(a,b){this.width=a,this.height=b}return a.prototype={clone:function(){return new a(this.width,this.height)},setExtent:function(a,b){this[a.getPropExtent()]=b},setMeasure:function(a,b){this[a.getPropMeasure()]=b},getCss:function(){var a={};return a.width=this.width+"px",a.height=this.height+"px",a},getMeasure:function(a){return this[a.getPropMeasure()]},getExtent:function(a){return this[a.getPropExtent()]}},a}(),mb=function(){function a(a){this.position=a}return a.prototype={isAbsolute:function(){return"absolute"===this.position},getCss:function(a){var b={};return b.position=this.position,this.start&&(b[a.getPropStart()]=this.start+"px"),this.end&&(b[a.getPropEnd()]=this.end+"px"),this.before&&(b[a.getPropBefore()]=this.before+"px"),this.after&&(b[a.getPropAfter()]=this.after+"px"),b}},a}(),nb=function(){function a(a,b){this.size=a,this.style=b,this.css={}}var b=function(c){return i.fold(c,[],function(c,d){return c.concat(d instanceof a?b(d.elements||[]):d)})};return a.prototype={isAnonymousLine:function(){return"inline"===this.display&&this.style.isRootLine()},toLineString:function(){var a=b(this.elements||[]);return i.fold(a,"",function(a,b){return a+(b?b.data||"":"")})},getClassName:function(){return this.classes?this.classes.join(" "):""},getContent:function(){return this.content||null},getOnCreate:function(){return this.isAnonymousLine()?null:this.style.getCssAttr("oncreate")},getAttrs:function(){return this.isAnonymousLine()?null:this.style.markup.attrs},getCssRoot:function(){switch(this.display){case"block":return this.getCssBlock();case"inline":return this.getCssInline();case"inline-block":return this.getCssInlineBlock()}},getCssBlock:function(){var a={};return r.copy(a,this.style.getCssBlock()),r.copy(a,this.size.getCss(this.style.flow)),this.edge&&r.copy(a,this.edge.getCss()),r.copy(a,this.css),a},getCssInline:function(){var a={};return r.copy(a,this.style.getCssInline()),r.copy(a,this.size.getCss(this.style.flow)),this.edge&&r.copy(a,this.edge.getCss()),r.copy(a,this.css),a},getCssInlineBlock:function(){var a=this.getCssBlock();return this.style.isFloated()||delete a["css-float"],a.display="inline-block",a},getContentMeasure:function(a){return a=a||this.style.flow,this.size.getMeasure(a)},getContentExtent:function(a){return a=a||this.style.flow,this.size.getExtent(a)},getContentWidth:function(){return this.size.width},getContentHeight:function(){return this.size.height},getEdgeMeasure:function(a){return a=a||this.style.flow,this.edge?this.edge.getMeasureSize(a):0},getEdgeExtent:function(a){return a=a||this.style.flow,this.edge?this.edge.getExtentSize(a):0},getLayoutMeasure:function(a){return a=a||this.style.flow,this.style.isPositionAbsolute()?0:this.getContentMeasure(a)+this.getEdgeMeasure(a)},getLayoutExtent:function(a){return a=a||this.style.flow,this.style.isPositionAbsolute()?0:this.getContentExtent(a)+this.getEdgeExtent(a)},clearBorderBefore:function(){this.edge&&this.edge.clearBorderBefore(this.style.flow)},clearBorderAfter:function(){this.edge&&this.edge.clearBorderAfter(this.style.flow)},resizeExtent:function(a,b){return this.size.setExtent(a,b),this}},a}(),ob=function(){function a(a){this.pos=0,this.buff=this._normalize(a),this.src=this.buff}var b=/\d\d|!\?|!!|\?!|\?\?/,d=/^([\w!\.\?\/\_:#;"',]+)/,e=/^(<[^>]+>)/,g=/^(&[^;\s]+;)/,h=function(a,b,c,d){var e=a.indexOf(d);if(0>e)return-1;var f=a.match(c),g=f?f.index:-1;if(0>g||g>e)return e;var i=g+b.length+2,j=h(a.substring(i),b,c,d);if(0>j)return-1;var k=i+j+b.length+3;return k+h(a.substring(k),b,c,d)};return a.prototype={_normalize:function(a){return a.replace(/(<\/[^>]+>)/g,function(a){return a.toLowerCase()}).replace(/^[ \n]+/,"").replace(/\s+$/,"").replace(/\r/g,"")},isEmpty:function(){return""===this.src},get:function(){var a=this._getToken();return a&&(a.spos=this.pos),a},getSrc:function(){return this.src},getSeekPercent:function(a){return Math.round(100*a/this.src.length)},_stepBuff:function(a){this.pos+=a,this.buff=this.buff.slice(a)},_getToken:function(){if(""===this.buff)return null;if(this.buff.match(e))return this._parseTag(RegExp.$1);if(this.buff.match(d)){var a=RegExp.$1;return 1===a.length?this._parseChar(a):2===a.length&&a.match(b)?this._parseTcy(a):this._parseWord(a)}return this.buff.match(g)?this._parseCharRef(RegExp.$1):this._parseChar(this._getChar())},_getRb:function(){var a=this.buffRb.substring(0,1);return this.buffRb=this.buffRb.slice(1),a},_getChar:function(){return this.buff.substring(0,1)},_getTagContent:function(a){var b=new RegExp("<"+a+"[\\s|>]"),d="</"+a+">",e=h(this.buff,a,b,d);if(e>=0)return{closed:!0,content:this.buff.substring(0,e)};if(c.enableAutoCloseTag){var f=this.buff.match(b);if(f)return{closed:!1,content:this.buff.substring(0,nexd_open_match.index)}}return{closed:!1,content:this.buff}},_parseTag:function(a){var b=new C(a);this._stepBuff(a.length);var c=b.getName();return f.isSingleTag(c)?(b._single=!0,b):this._parseChildContentTag(b)},_parseTcyTag:function(a){var b=this._getTagContent(a.name);return this._stepBuff(b.length+a.name.length+3),new G(b)},_parseChildContentTag:function(a){var b=this._getTagContent(a.name);return a.setContent(k.trimCRLF(b.content)),this._stepBuff(b.closed?b.content.length+a.name.length+3:b.content.length),a},_parseWord:function(a){return this._stepBuff(a.length),new F(a)},_parseTcy:function(a){return this._stepBuff(a.length),new G(a)},_parseChar:function(a){return this._stepBuff(a.length),new E(a,!1)},_parseCharRef:function(a){return this._stepBuff(a.length),new E(a,!0)}},a}(),pb=function(){function a(a,b,c){this.rank=a,this.title=b,this._id=c||0}return a.prototype={getId:function(){return this._id}},a}(),qb=function(){function a(a,b,c){this._type=a,this._header=null,this._auto=!1,this._next=null,this._child=null,this._parent=b||null,this._pageNo=c||0}return a.prototype={isRoot:function(){return null===this._parent},isAuto:function(){return this._auto},hasHeader:function(){return null!==this._header},hasHeaderId:function(){return this.getHeaderId()>0},hasChild:function(){return null!==this._child},hasNext:function(){return null!==this._next},getNext:function(){return this._next},getChild:function(){return this._child},getParent:function(){return this._parent},getHeader:function(){return this._header},getHeaderId:function(){return this._header?this._header.getId():null},setHeader:function(a){this._header=a},setAuto:function(){this._auto=!0},getRank:function(){return this._header?this._header.rank:0},getTitle:function(){return this._header?this._header.title:["untitled",this._type].join(" ")},getType:function(){return this._type},getPageNo:function(){return this._pageNo},updatePageNo:function(a){this._pageNo=a},addChild:function(a){null===this._child?this._child=a:this._child.addNext(a)},addNext:function(a){null===this._next?this._next=a:this._next.addNext(a)}},a}(),rb=function(){function a(){this.stack=[1]}return a.prototype={toString:function(){return this.stack.join(".")},stepNext:function(){return this.stack.length>0&&this.stack[this.stack.length-1]++,this},startRoot:function(){return this.stack.push(1),this},endRoot:function(){return this.stack.pop(),this}},a}(),sb=function(){function a(a){this.logs=[],this.style=a}var b=0,c=function(){return b++};return a.prototype={isEmpty:function(){return 0===this.logs.length},get:function(a){return this.logs[a]||null},getMarkupName:function(){return this.style.getMarkupName()},startSection:function(a){return this.logs.push({name:"start-section",type:a,pageNo:wb.pageNo}),this},endSection:function(a){return this.logs.push({name:"end-section",type:a}),this},addHeader:function(a){var b=c();return this.logs.push({name:"set-header",type:a.type,rank:a.rank,title:a.title,pageNo:wb.pageNo,headerId:b}),b}},a}(),tb=function(){var a=function(a,b,c){var d=a.get(c++);if(null!==d){switch(d.name){case"start-section":var e=new qb(d.type,b,d.pageNo);b&&b.addChild(e),arguments.callee(a,e,c);break;case"end-section":arguments.callee(a,b.getParent(),c);break;case"set-header":var f=new pb(d.rank,d.title,d.headerId);if(null===b){var g=new qb("section",null,d.pageNo);g.setHeader(f),arguments.callee(a,g,c)}else if(b.hasHeader()){var h=d.rank,i=b.getRank();if(i>h)c=Math.max(0,c-1),arguments.callee(a,b.getParent(),c);else if(d.rank==i){var j=new qb("section",b,d.pageNo);j.setHeader(f),b.addNext(j),arguments.callee(a,j,c)}else{var k=new qb("section",b,d.pageNo);k.setHeader(f),b.addChild(k),arguments.callee(a,k,c)}}else b.setHeader(f),arguments.callee(a,b,c)}return b}};return{parse:function(b){var c=0,d=new qb("section",null,0);return a(b,d,c)}}}(),ub=function(){var a={onClickLink:function(){return!1},createToc:function(a,b){return{tocPos:a.toString(),title:b.getTitle(),pageNo:b.getPageNo(),headerId:b.getHeaderId()}},createRoot:function(){var a=document.createElement("ul");return a.className="nehan-toc-root",a},createChild:function(){var a=document.createElement("li");return a.className="nehan-toc-item",a},createLink:function(a){var b=document.createElement("a"),c=a.title.replace(/<a[^>]+>/gi,"").replace(/<\/a>/gi,"");return b.href="#"+a.pageNo,b.innerHTML=c,b.className="nehan-toc-link",b.id=o.addNehanTocLinkPrefix(a.tocId),b},createPageNoItem:function(){return null}},b=function(a,b,c,d){if(null===c)return b;var e=d.createToc(a,c),f=d.createChild(e),g=d.createLink(e);g&&(g.onclick=function(){return d.onClickLink(e)},f.appendChild(g));var h=d.createPageNoItem(e);h&&f.appendChild(h),b.appendChild(f);var i=c.getChild();if(i){a=a.startRoot();var j=d.createToc(a,i),k=d.createRoot(j);arguments.callee(a,k,i,d),f.appendChild(k),a=a.endRoot()}var l=c.getNext();return l&&arguments.callee(a.stepNext(),b,l,d),b};return{convert:function(c,d){d=r.merge({},a,d||{});var e=new rb,f=d.createRoot();return b(e,f,c,d)}}}(),vb=function(){function a(){this.title="",this.metas=[],this.links=[],this.scripts=[],this.styles=[]}return a.prototype={setTitle:function(a){this.title=a},getTitle:function(){return this.title},addLink:function(a){this.links.push(a)},getLinks:function(){return this.links},addMeta:function(a){this.metas.push(a)},getMetas:function(){return this.metas},getMetaByName:function(a){return i.find(this.metas,function(b){return b.getTagAttr("name")===a})},getMetaContentByName:function(a){var b=this.getMetaByName(a);return b?b.getTagAttr("content"):null},addScript:function(a){this.scripts.push(a)},getScripts:function(){return this.scripts},addStyle:function(a){this.styles.push(a)},getStyles:function(){return this.styles}},a}(),wb={documentType:"html",documentHeader:null,pageNo:0,charPos:0,anchors:{},outlineContexts:[],createBodyOutlineElement:function(a){var b=this.createOutlineElementsByName("body",a);return b.length>0?b[0]:null},getOutlineContextsByName:function(a){return i.filter(this.outlineContexts,function(b){return b.getMarkupName()===a})},createOutlineElementsByName:function(a,b){var c=this.getOutlineContextsByName(a);return i.fold(c,[],function(a,c){var d=tb.parse(c);return d?a.concat(ub.convert(d,b)):a})},addOutlineContext:function(a){this.outlineContexts.push(a)},addAnchor:function(a){this.anchors[a]=this.pageNo},getAnchorPageNo:function(a){return"undefined"==typeof this.anchors[a]?null:this.anchors[a]}},xb=function(){function a(a){this.lexer=this._createLexer(a),this.tokens=[],this.pos=0,this.eof=!1,this._doBuffer()}return a.prototype={hasNext:function(){return!this.eof||this.pos<this.tokens.length},isEmpty:function(){return this.lexer.isEmpty()},isEmptyTokens:function(){return 0===this.tokens.length},isHead:function(){return 0===this.pos},prev:function(){this.pos=Math.max(0,this.pos-1)},setPos:function(a){this.pos=a},rewind:function(){this.pos=0},peek:function(a){var b=a||0,c=Math.max(0,this.pos+b);if(c>=this.tokens.length){if(this.eof)return null;this._doBuffer()}var d=this.tokens[c];return d?(d.pos=c,d):null},get:function(){var a=this.peek();return this.pos++,a},getSrc:function(){return this.lexer.getSrc()},getPos:function(){return this.pos},getTokenCount:function(){return this.tokens.length},getSeekPos:function(){var a=this.tokens[this.pos];return a?a.spos:0},getSeekPercent:function(){var a=this.getSeekPos();return this.lexer.getSeekPercent(a)},getAll:function(){for(;!this.eof;)this._doBuffer();return this.tokens},getAllIf:function(a){return i.filter(this.getAll(),function(b){return a(b)})},getWhile:function(a){for(var b,c=[];this.hasNext();){if(b=this.get(),!b||!a(b)){this.prev();break}c.push(b)}return c},mapWhile:function(a){for(var b,c,d=[];this.hasNext();){if(b=this.get(),c=a(b),!b||!c){this.prev();break}d.push(c)}return d},skipUntil:function(a){for(;this.hasNext();){var b=this.get();if(null===b)break;if(!a(b)){this.prev();break}}},_createLexer:function(a){return new ob(a)},_doBuffer:function(){for(var a=c.lexingBufferLen,b=0;a>b;b++){var d=this.lexer.get();if(null===d){this.eof=!0;break}this.tokens.push(d)}}},a}(),yb=function(){function a(a,b){xb.call(this,a);var c=0;this.tokens=this.getAllIf(function(a){return D.isText(a)?!1:b(a)?(a.order=c++,!0):void 0})}return h.extend(a,xb),a}(),zb=function(){function a(a){yb.call(this,a,function(a){var b=a.getName();return"!doctype"===b||"html"===b}),this.isEmptyTokens()&&(this.tokens=[new C("html",a)])}return h.extend(a,yb),a}(),Ab=function(){function a(a){yb.call(this,a,function(a){var b=a.getName();return"head"===b||"body"===b})}return h.extend(a,yb),a}(),Bb=function(){function a(a){yb.call(this,a,function(a){var b=a.getName();return"title"===b||"meta"===b||"link"===b||"style"===b||"script"===b})}return h.extend(a,yb),a}(),Cb=function(){function a(a){xb.call(this,a.getContent()),this.getAll(),this.tokens=this._parse(a),this.rewind()}return h.extend(a,xb),a.prototype._parse=function(a){for(var b=[];this.hasNext();)b.push(this._parseRuby(a));return b},a.prototype._parseRuby=function(){for(var a=[],b=null;;){var c=this.get();if(null===c)break;if(D.isTag(c)&&"rt"===c.getName()){b=c;break}D.isText(c)&&a.push(c)}return new H(a,b)},a}(),Db=function(){function a(a){r.merge(this,{element:null,seekPos:0,pageNo:0,charPos:0,charCount:0,percent:0},a)}return a}(),Eb=function(){function a(){this.evaluator=this._getEvaluator()}return a.prototype={_getEvaluator:function(){return"vert"===d.direction?new rc:new sc},evaluate:function(a){return a?new Db({element:this.evaluator.evaluate(a),percent:a.percent,seekPos:a.seekPos,pageNo:a.pageNo,charPos:a.charPos,charCount:a.charCount}):null}},a}(),Fb=function(){function a(a){this.text=this._createSource(a),this._trees=[],this._pages=[],this.generator=this._createGenerator(this.text),this.evaluator=this._createEvaluator()}return a.prototype={hasPage:function(a){return"undefined"!=typeof this._trees[a]},hasNext:function(){return this.generator.hasNext()},setTerminate:function(a){this.generator.setTerminate(a)},syncGet:function(){var a=0;for(this._setTimeStart();this.hasNext();)if(!this.hasPage(a)){var b=this._yield();b&&(this._addTree(b),a++)}return this._getTimeElapsed()},asyncGet:function(a){r.merge(this,{onComplete:function(){},onProgress:function(){},onError:function(){}},a||{}),this._setTimeStart(),this._asyncGet(a.wait||0)},getPageCount:function(){return this._trees.length},get:function(a){return this.getPage(a)},getPage:function(a){if(this._pages[a])return this._pages[a];var b=this._trees[a]||null;if(null===b)return null;var c=this.evaluator.evaluate(b);return this._pages[a]=c,c},getTree:function(a){return this._trees[a]||null},_yield:function(){return this.generator.yield()},_setTimeStart:function(){return this._timeStart=(new Date).getTime(),this._timeStart},_getTimeElapsed:function(){return(new Date).getTime()-this._timeStart},_asyncGet:function(a){if(!this.generator.hasNext())return void this.onComplete(this,this._getTimeElapsed());var b=this._yield();b&&(this._addTree(b),this.onProgress(this,b));var c=this;m(function(){c._asyncGet(a)})},_addTree:function(a){this._trees.push(a)},_createSource:function(a){return a.replace(/\t/g,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<rp>[^<]*<\/rp>/gi,"").replace(/<rb>/gi,"").replace(/<\/rb>/gi,"").replace(/<rt><\/rt>/gi,"")},_createGenerator:function(a){switch(d.root){case"document":return new pc(a);case"html":return new oc(a);default:return new nc(a)}},_createEvaluator:function(){return new Eb}},a}(),Gb={set:function(a,b,c){a.isKakkoStart()?this._setKerningStart(a,b):(a.isKakkoEnd()||a.isKutenTouten())&&this._setKerningEnd(a,c)},_setKerningStart:function(a,b){var c=this._getTextSpaceStart(a,b);c>0&&(a.spaceRateStart=c)},_setKerningEnd:function(a,b){var c=this._getTextSpaceEnd(a,b);c>0&&(a.spaceRateEnd=c)},_getTextSpaceStart:function(a,b){return null===b?.5:D.isChar(b)&&b.isKakkoStart()?0:.5},_getTextSpaceEnd:function(a,b){return null===b?.5:D.isChar(b)&&(b.isKakkoEnd()||b.isKutenTouten())?0:.5}},Hb=function(){function a(a){this.value=a||"none"}return a.prototype={getCss:function(a){var b={};return a.isTextHorizontal()&&(this.isStart()?b["css-float"]="left":this.isEnd()&&(b["css-float"]="right")),b},isStart:function(){return"start"===this.value},isEnd:function(){return"end"===this.value},isNone:function(){return"none"===this.value}},a}(),Ib={start:new Hb("start"),end:new Hb("end"),none:new Hb("none"),get:function(a){return this[a]||null}},Jb=function(){function a(a){this.value=a}return a.prototype={isAlways:function(){return"always"===this.value},isAvoid:function(){return"avoid"===this.value},isFirst:function(){return"lr"===d.getPagingDirection()?"left"===this.value:"right"===this.value},isSecond:function(){return"lr"===d.getPagingDirection()?"right"===this.value:"left"===this.value},isNth:function(){}},a}(),Kb={before:{always:new Jb("always"),avoid:new Jb("avoid"),left:new Jb("left"),right:new Jb("right"),first:new Jb("first"),second:new Jb("second")},after:{always:new Jb("always"),avoid:new Jb("avoid"),left:new Jb("left"),right:new Jb("right"),first:new Jb("first"),second:new Jb("second")},getBefore:function(a){return this.before[a]||null},getAfter:function(a){return this.after[a]||null}},Lb=function(){function a(a){this.value=a||"start"}return a.prototype={isStart:function(){return"start"===this.value},isEnd:function(){return"end"===this.value},isCenter:function(){return"center"===this.value},getCss:function(){var a={};return"center"===this.value,a}},a}(),Mb={start:new Lb("start"),end:new Lb("end"),center:new Lb("center"),get:function(a){return this[a]||null}},Nb=function(){function a(a,b){this._style=a,this._layoutContext=b||null}return a.prototype={getParentStyle:function(){return this._style.parent},getMarkup:function(){return this._style.markup},getRestMeasure:function(){return this._layoutContext?this._layoutContext.getInlineRestMeasure():null},getRestExtent:function(){return this._layoutContext?this._layoutContext.getBlockRestExtent():null},getChildIndex:function(){return this._style.getChildIndex()},getChildIndexOfType:function(){return this._style.getChildIndexOfType}},a}(),Ob=function(){function a(a,b){Nb.call(this,a,b)}return h.extend(a,Nb),a.prototype.getCssAttr=function(a,b){return this._style.getCssAttr(a,b)},a.prototype.setCssAttr=function(a,b){this._style.inlineCss[a]=b},a}(),Pb=function(){function a(a,b,c){this._initialize(a,b,c)}var b=/(^(<[^>]+>|[\s\n])*)(\S)/im,c=["script","noscript","style","input","iframe","form"],f=["border-color","border-radius","border-style","border-width","box-sizing","break-after","break-before","color","display","extent","embeddable","float","flow","font-family","font-size","font-style","font-weight","height","interactive","letter-spacing","line-rate","list-style-type","list-style-position","list-style-image","margin","measure","meta","onload","oncreate","padding","position","section","section-root","text-align","text-emphasis-style","text-emphasis-position","text-emphasis-color","text-combine","width"],g=["line-height"],h=function(a){return i.exists(g,q.eq(a))},l=function(a){return i.exists(f,q.eq(a))},m=function(a){var b={};return j.iter(a,function(a,c){l(a)||h(a)||(b[a]=c)}),b},o=function(a){var b=[];return i.iter(a,function(a){a instanceof nb!=!1&&(a.style.isTextEmphaEnable()||"ruby"===a.style.getMarkupName()?b.push(a):a.elements&&(b=b.concat(o(a.elements))))}),b};return a.prototype={_initialize:function(a,b,c){c=c||{},this.markup=a,this.markupName=a.getName(),this.parent=b||null,this.childs=[],this.next=null,this.prev=null,b&&b.appendChild(this),this.selectorContext=new Nb(this,c.layoutContext||null),this.callbackContext=new Ob(this,c.layoutContext||null),this.selectorCss={},this.inlineCss={},this.unmanagedCss={},r.copy(this.selectorCss,this._loadSelectorCss(a,b)),r.copy(this.selectorCss,this._loadCallbackCss("onload")),r.copy(this.inlineCss,this._loadInlineCss(a)),r.copy(this.inlineCss,c.forceCss||{}),r.copy(this.unmanagedCss,m(this.selectorCss)),r.copy(this.unmanagedCss,m(this.inlineCss)),r.copy(this.unmanagedCss,this._loadUnmanagedCss(this.unmanagedCss)),this.display=this._loadDisplay(),this.flow=this._loadFlow(),this.boxSizing=this._loadBoxSizing();var d=this._loadColor();d&&(this.color=d);var e=this._loadFont();e&&(this.font=e);var f=this._loadPosition();f&&(this.position=f);var g=this._loadEdge(this.flow,this.getFontSize());g&&(this.edge=g);var h=this._loadLineRate();h&&(this.lineRate=h);var i=this._loadTextAlign();i&&(this.textAlign=i);var j=this._loadTextEmpha();j&&(this.textEmpha=j);var k=this._loadTextCombine();k&&(this.textCombine=k);var l=this._loadListStyle();l&&(this.listStyle=l);var n=this._loadFloatDirection();n&&(this.floatDirection=n);var o=this._loadBreakBefore();o&&(this.breakBefore=o);var p=this._loadBreakAfter();p&&(this.breakAfter=p),this.staticMeasure=this._loadStaticMeasure(),this.staticExtent=this._loadStaticExtent(),this.initContextSize(this.staticMeasure,this.staticExtent)},initContextSize:function(a,b){this.outerMeasure=a||(this.parent?this.parent.contentMeasure:d.getMeasure(this.flow)),this.outerExtent=b||(this.parent?this.parent.contentExtent:d.getExtent(this.flow)),this.contentMeasure=this._computeContentMeasure(this.outerMeasure),this.contentExtent=this._computeContentExtent(this.outerExtent)},updateStaticSize:function(a,b){this.staticMeasure=a,this.staticExtent=b,this.updateContextSize(a,b)},updateContextSize:function(a,b){this.initContextSize(a,b),i.iter(this.childs,function(a){a.updateContextSize(null,null)})},clone:function(b){return null===this.parent?this.createChild("div",b):new a(this.markup,this.parent,{forceCss:b||{}})},appendChild:function(a){if(this.childs.length>0){var b=i.last(this.childs);b.next=a,a.prev=b}this.childs.push(a)},removeChild:function(a){var b=i.indexOf(this.childs,q.eq(a));if(b>=0){var c=this.childs.splice(b,1);return c}return null},createChild:function(b,c){var d=new C("<"+b+">"),e=new a(d,this,{forceCss:c||{}});return e.contextParent=this.parent,e},createBlock:function(a){a=a||{};var b=a.elements||[],c=this.contentMeasure,d=this.parent&&a.extent&&null===this.staticExtent?a.extent:this.contentExtent,e=this.flow.getBoxSize(c,d),f=["nehan-block","nehan-"+this.getMarkupName()].concat(this.markup.getClasses()),g=new nb(e,this);return g.display="inline-block"===this.display?this.display:"block",g.edge=this.edge||null,g.elements=b,g.classes=f,g.charCount=i.fold(b,0,function(a,b){return a+(b?b.charCount||0:0)}),g.breakAfter=this.isBreakAfter()||a.breakAfter||!1,g.content=a.content||null,g},createImage:function(a){a=a||{};var b=this.getMarkupAttr("width")?parseInt(this.getMarkupAttr("width"),10):this.staticMeasure||this.font.size,c=this.getMarkupAttr("height")?parseInt(this.getMarkupAttr("height"),10):this.staticExtent||this.font.size,d=["nehan-block","nehan-image"].concat(this.markup.getClasses()),e=new lb(b,c),f=new nb(e,this);return f.display=this.display,f.edge=this.edge||null,f.classes=d,f.charCount=0,this.isPushed()?f.pushed=!0:this.isPulled()&&(f.pulled=!0),f.breakAfter=this.isBreakAfter()||a.breakAfter||!1,f},createLine:function(a){a=a||{};var b=a.elements||[],c=a.maxFontSize||this.getFontSize(),d=a.maxExtent||0;d=this.isTextEmphaEnable()?Math.max(d,this.getEmphaLineExtent()):"ruby"===this.markup.name?Math.max(d,this.getRubyLineExtent()):Math.max(d,this.getAutoLineExtent());var e=this.parent&&a.measure&&null===this.staticMeasure&&!this.isRootLine()?a.measure:this.contentMeasure;"inline-block"===this.display&&(e=this.staticMeasure||a.measure);var f=this.flow.getBoxSize(e,d),g=["nehan-inline","nehan-inline-"+this.flow.getName()].concat(this.markup.getClasses()),h=new nb(f,this);return h.display="inline",h.elements=a.elements||[],h.classes=this.isRootLine()?g:g.concat("nehan-"+this.getMarkupName()),h.charCount=a.charCount||0,h.maxFontSize=c,h.maxExtent=d,h.content=a.content||null,h.edge=this.edge&&!this.isRootLine()?this.edge:null,this.isRootLine()&&(h.lineBreak=a.lineBreak||!1,h.breakAfter=a.breakAfter||!1,h.inlineMeasure=a.measure||this.contentMeasure,h.texts=a.texts||[],this.isTextVertical()&&this._setVertBaseline(b,c,d),this.textAlign&&!this.textAlign.isStart()&&this._setTextAlign(h,this.textAlign)),h},createBreakLine:function(){var a=new nb(this.flow.getBoxSize(this.contentMeasure,0),this);return a.breakAfter=!0,a.elements=[],a},isDisabled:function(){return i.exists(c,q.eq(this.getMarkupName()))?!0:this.contentMeasure<=0||this.contentExtent<=0?!0:this.markup.isCloseTag()?!0:!this.markup.isSingleTag()&&this.isBlock()&&this.isMarkupEmpty()&&""===this.getContent()?!0:!1},isBlock:function(){switch(this.display){case"block":case"table":case"table-caption":case"table-header-group":case"table-row-group":case"table-footer-group":case"table-row":case"table-cell":case"list-item":return!0}return!1},isRoot:function(){return null===this.parent},isChildBlock:function(){return this.isBlock()&&!this.isRoot()},isInlineBlock:function(){return"inline-block"===this.display},isInline:function(){return"inline"===this.display},isRootLine:function(){return this.isBlock()||this.isInlineBlock()},isFloatStart:function(){return this.floatDirection&&this.floatDirection.isStart()},isFloatEnd:function(){return this.floatDirection&&this.floatDirection.isEnd()},isFloated:function(){return this.isFloatStart()||this.isFloatEnd()},isParallel:function(){return"list-item"===this.display},isPushed:function(){return null!==this.getMarkupAttr("pushed")},isPulled:function(){return null!==this.getMarkupAttr("pulled")},isPasted:function(){return null!==this.getMarkupAttr("pasted")},isTextEmphaEnable:function(){return this.textEmpha&&this.textEmpha.isEnable()?!0:!1},isTextVertical:function(){return this.flow.isTextVertical()},isTextHorizontal:function(){return this.flow.isTextHorizontal()},isPositionAbsolute:function(){return this.position.isAbsolute()},isPre:function(){var a=this.getCssAttr("white-space","normal");return"pre"===a},isPageBreak:function(){switch(this.getMarkupName()){case"page-break":case"end-page":case"pbr":return!0;default:return!1}},isBreakBefore:function(){return this.breakBefore?!this.breakBefore.isAvoid():!1},isBreakAfter:function(){return this.breakAfter?!this.breakAfter.isAvoid():!1},isFirstChild:function(){var a=this.getParentChilds();return a.length>0&&a[0]===this},isFirstOfType:function(){var a=this.getParentChildsOfType(this.getMarkupName());return a.length>0&&a[0]===this},isLastChild:function(){return!1},isLastOfType:function(){return!1},isOnlyChild:function(){var a=this.getParentChilds();return 1===a.length&&a[0]===this},isOnlyOfType:function(){var a=this.getParentChildsOfType(this.getMarkupName());return 1===a.length&&a[0]===this},isMarkupEmpty:function(){return this.markup.isEmpty()},hasFlipFlow:function(){return this.parent?this.flow!==this.parent.flow:!1},getAttr:function(a,b){var c=this.getMarkupAttr(a);return"undefined"!=typeof c&&null!==c?c:(c=this.getCssAttr(a),"undefined"!=typeof c&&null!==c?c:"undefined"!=typeof b?b:null)},getMarkupAttr:function(a,b){return"id"===a?this.markup.id:this.markup.getAttr(a,b)},_evalCssAttr:function(a,b){return"oncreate"===a?b:"function"==typeof b?s.formatValue(a,b(this.selectorContext)):b},getCssAttr:function(a,b){var c;return c=this.getInlineCssAttr(a),null!==c?this._evalCssAttr(a,c):(c=this.getSelectorCssAttr(a),null!==c?this._evalCssAttr(a,c):"undefined"!=typeof b?b:null)},getInlineCssAttr:function(a){return this.inlineCss[a]||null},getSelectorCssAttr:function(a){return this.selectorCss[a]||null},getMarkupName:function(){return this.markup.getName()},getMarkupId:function(){return this.markup.getId()},getMarkupClasses:function(){return this.markup.getClasses()},getMarkupContent:function(){return this.markup.getContent()},getMarkupPos:function(){return this.markup.pos},getContent:function(){var a=this.markup.getContent();this.isBreakBefore()&&(a="<page-break>"+a);var c=z.getValuePe(this,"before");j.isEmpty(c)||(a=p.tagWrap("before",c.content||"")+a);var d=z.getValuePe(this,"after");j.isEmpty(d)||(a+=p.tagWrap("after",d.content||""));var e=z.getValuePe(this,"first-letter");j.isEmpty(e)||(a=a.replace(b,function(a,b,c,d){return b+p.tagWrap("first-letter",d)}));var f=z.getValuePe(this,"first-line");return j.isEmpty(f)||(a=p.tagWrap("first-line",a)),a},getHeaderRank:function(){return this.markup.getHeaderRank()},getFontSize:function(){return this.font.size},getFontFamily:function(){return this.font.family||d.fontFamily},getTextAlign:function(){return this.textAlign||Mb.get("start")},getTextCombine:function(){return this.textCombine||null},getLetterSpacing:function(){return this.letterSpacing||0},getMarkerHtml:function(a){return this.listStyle?this.listStyle.getMarkerHtml(a):""},getColor:function(){return this.color||(this.parent?this.parent.getColor():new J(d.fontColor))},getChildCount:function(){return this.childs.length},getChildIndex:function(){var a=this;return i.indexOf(this.getParentChilds(),function(b){return b===a})},getChildIndexOfType:function(){var a=this;return i.indexOf(this.getParentChildsOfType(this.getMarkupName()),function(b){return b===a})},getNthChild:function(a){return this.childs[a]||null},getParentChilds:function(){return this.parent?this.parent.childs:[]},getParentNthChild:function(a){return this.parent?this.parent.getNthChild(a):null},getParentChildsOfType:function(a){return i.filter(this.getParentChilds(),function(b){return b.getMarkupName()===a})},getParentFlow:function(){return this.parent?this.parent.flow:this.flow},getParentContentMeasure:function(){return this.parent?this.parent.contentMeasure:this.contentMeasure},getNextSibling:function(){return this.next},getLineRate:function(){return this.lineRate||d.lineRate||2},getEmphaLineExtent:function(){return 3*this.getFontSize()},getRubyLineExtent:function(){var a=this.getFontSize(),b=Math.floor(a*this.getLineRate()),c=d.getRtFontSize(a);return b+c},getAutoLineExtent:function(){return Math.floor(this.getFontSize()*this.getLineRate())},getEdge:function(){return this.contextParent?this.contextParent.getEdge():this.edge||null},getEdgeMeasure:function(a){var b=this.getEdge();return b?b.getMeasureSize(a||this.flow):0},getEdgeExtent:function(a){var b=this.getEdge();return b?b.getExtentSize(a||this.flow):0},getInnerEdgeMeasure:function(){var a=this.getEdge();return a?a.getInnerMeasureSize():0
},getInnerEdgeExtent:function(){var a=this.getEdge();return a?a.getInnerExtentSize():0},getCssBlock:function(){var a={};return a.display="block",this.font&&r.copy(a,this.font.getCss()),this.parent&&r.copy(a,this.parent.flow.getCss()),this.color&&r.copy(a,this.color.getCss()),this.letterSpacing&&!this.flow.isTextVertical()&&(a["letter-spacing"]=this.letterSpacing+"px"),this.floatDirection&&r.copy(a,this.floatDirection.getCss(this.flow)),this.position&&r.copy(a,this.position.getCss()),this.zIndex&&(a["z-index"]=this.zIndex),r.copy(a,this.unmanagedCss),a.overflow="hidden",a},getCssInline:function(){var a={};return a["line-height"]="1em",this.parent&&this.isRootLine()&&r.copy(a,this.parent.flow.getCss()),this.font&&r.copy(a,this.font.getCss()),this.color&&r.copy(a,this.color.getCss()),this.isRootLine()&&r.copy(a,this.flow.getCss()),this.flow.isTextVertical()&&(e.isIphoneFamily&&(a["letter-spacing"]="-0.001em"),"ruby"!==this.markup.getName()&&(a["margin-left"]=a["margin-right"]="auto",a["text-align"]="center")),r.copy(a,this.unmanagedCss),a},_computeContentMeasure:function(a){switch(this.boxSizing){case"margin-box":return a-this.getEdgeMeasure();case"border-box":return a-this.getInnerEdgeMeasure();case"content-box":return a;default:return a}},_computeContentExtent:function(a){switch(this.boxSizing){case"margin-box":return a-this.getEdgeExtent();case"border-box":return a-this.getInnerEdgeExtent();case"content-box":return a;default:return a}},_computeFontSize:function(a,b){var c=String(a).replace(/\/.+$/,""),e=d.fontSizeNames[c]||c,f=this._computeUnitSize(e,b);return Math.min(f,d.maxFontSize)},_computeUnitSize:function(a,b){var c=String(a);if(c.indexOf("rem")>0){var e=parseFloat(c.replace("rem",""));return Math.round(d.fontSize*e)}if(c.indexOf("em")>0){var f=parseFloat(c.replace("em",""));return Math.round(b*f)}if(c.indexOf("pt")>0)return Math.round(4*parseInt(c,10)/3);if(c.indexOf("%")>0){var g=this.getParentContentMeasure();return Math.round(g*parseInt(c,10)/100)}var h=parseInt(c,10);return isNaN(h)?0:h},_computeCornerSize:function(a,b){var c={};for(var d in a)c[d]=[0,0],c[d][0]=this._computeUnitSize(a[d][0],b),c[d][1]=this._computeUnitSize(a[d][1],b);return c},_computeEdgeSize:function(a,b){var c={};for(var d in a)c[d]=this._computeUnitSize(a[d],b);return c},_setTextAlign:function(a,b){var c=a.getContentMeasure(this.flow),d=c-a.inlineMeasure;if(!(0>=d)){var e=new db;if(b.isCenter()){var f=Math.floor(d/2);a.size.setMeasure(this.flow,c-f),e.setStart(this.flow,f),r.copy(a.css,e.getCss())}else b.isEnd()&&(a.size.setMeasure(this.flow,a.inlineMeasure),e.setStart(this.flow,d),r.copy(a.css,e.getCss()))}},_setVertBaseline:function(a,b,c){var d=this.flow,e=(this.getFontSize(),Math.floor(c/2));i.iter(a,function(a){a instanceof nb&&"img"!==a.style.getMarkupName()&&"inline-block"!==a.style.display&&a.size.setExtent(d,c)});var f=o(a);i.iter(f,function(a){var b=a.style.getFontSize(),c=e-Math.floor(b/2);if(c>0){var f=a.style.edge?a.style.edge.clone():new kb;f.padding.setAfter(d,c),r.copy(a.css,f.getCss(d))}})},_loadSelectorCss:function(a,b){switch(a.getName()){case"before":case"after":case"first-letter":case"first-line":return z.getValuePe(b,a.getName());default:return z.getValue(this)}},_loadInlineCss:function(a){var b=a.getAttr("style");if(null===b)return{};var c=b.indexOf(";")>=0?b.split(";"):[b];return i.fold(c,{},function(a,b){var c=b.split(":");if(c.length>=2){var d=k.trim(c[0]).toLowerCase(),e=k.trim(c[1]),f=s.formatProp(d),g=s.formatValue(d,e);a[f]=g}return a})},_loadCallbackCss:function(a){var b=this.getSelectorCssAttr(a);if(null===b||"function"!=typeof b)return{};var c=b(this.callbackContext)||{};for(var d in c)c[d]=this._evalCssAttr(d,c[d]);return c},_loadUnmanagedCss:function(a){var b={};for(var c in a)b[c]=this._evalCssAttr(c,a[c]);return b},_loadDisplay:function(){return this.getCssAttr("display","inline")},_loadFlow:function(){var a=this.getCssAttr("flow","inherit"),b=this.parent?this.parent.flow:d.getStdBoxFlow();return"inherit"===a?b:"flip"===a?b.getFlipFlow():W.getByName(a)},_loadPosition:function(){var a=this.getCssAttr("position","static");if("start"===a)return null;var b=new mb(a),c=this;return i.iter(n.cssBoxDirsLogical,function(a){var d=c.getCssAttr(a,"auto");"auto"!==d&&(b[d]=c._computeUnitSize(start,c.font.size))}),b},_loadColor:function(){var a=this.getCssAttr("color","inherit");return"inherit"!==a?new J(a):void 0},_loadFont:function(){var a=this.parent?this.parent.font.size:d.fontSize,b=new Z(a),c=this.getCssAttr("font-size","inherit");"inherit"!==c&&(b.size=this._computeFontSize(c,a));var e=this.getCssAttr("font-family","inherit");"inherit"!==e?b.family=e:null===this.parent&&(b.family=d.fontFamily);var f=this.getCssAttr("font-weight","inherit");"inherit"!==f&&(b.weight=f);var g=this.getCssAttr("font-style","inherit");return"inherit"!==g&&(b.style=g),b},_loadBoxSizing:function(){return this.getCssAttr("box-sizing","margin-box")},_loadEdge:function(a,b){var c=this._loadPadding(a,b),d=this._loadMargin(a,b),e=this._loadBorder(a,b);return null===c&&null===d&&null===e?null:new kb({padding:c,margin:d,border:e})},_loadEdgeSize:function(a,b){var c=this.getCssAttr(b);return null===c?null:this._computeEdgeSize(c,a)},_loadPadding:function(a,b){var c=this._loadEdgeSize(b,"padding");if(null===c)return null;var d=new db;return d.setSize(a,c),d},_loadMargin:function(a,b){var c=this._loadEdgeSize(b,"margin");if(null===c)return null;var d=new eb;return d.setSize(a,c),this.prev&&"block"===this.prev.display&&!this.prev.isFloated()&&this.prev.edge&&this.flow===this.prev.flow&&"block"===this.display&&!this.isFloated()&&this.prev.edge.margin.getAfter(this.flow)>0&&d.getBefore(this.flow)>0&&this._cancelMargin(this.flow,d,this.prev.edge.margin),d},_cancelMargin:function(a,b,c){var d=c.getAfter(a),e=b.getBefore(a);d>=e?b.setBefore(a,0):b.setBefore(a,e-d)},_loadBorder:function(a,b){var c=this._loadEdgeSize(b,"border-width");if(null===c)return null;var d=new fb;d.setSize(a,c);var e=this.getCssAttr("border-radius");e&&d.setRadius(a,this._computeCornerSize(e,b));var f=this.getCssAttr("border-color");f&&d.setColor(a,f);var g=this.getCssAttr("border-style");return g&&d.setStyle(a,g),d},_loadLineRate:function(){var a=this.getCssAttr("line-rate","inherit");return"inherit"===a&&this.parent&&this.parent.lineRate?this.parent.lineRate:parseFloat(a||d.lineRate)},_loadTextAlign:function(){var a=this.getCssAttr("text-align","inherit");return"inherit"===a&&this.parent&&this.parent.textAlign?this.parent.textAlign:Mb.get(a||"start")},_loadTextEmpha:function(){var a=this.getCssAttr("text-emphasis-style","none");if("none"===a||"inherit"===a)return null;var b=this.getCssAttr("text-emphasis-position",{hori:"over",vert:"right"}),c=this.getCssAttr("text-emphasis-color");return new ib({style:new gb(a),pos:new hb(b),color:c?new J(c):this.getColor()})},_loadTextEmphaStyle:function(){var a=this.getCssAttr("text-emphasis-style","inherit");return"inherit"!==a?new gb(a):null},_loadTextEmphaPos:function(){return this.getCssAttr("text-emphasis-position",{hori:"over",vert:"right"})},_loadTextEmphaColor:function(a){return this.getCssAttr("text-emphasis-color",a.getValue())},_loadTextCombine:function(){return this.getCssAttr("text-combine")},_loadFloatDirection:function(){var a=this.getCssAttr("float","none");return"none"===a?null:Ib.get(a)},_loadBreakBefore:function(){var a=this.getCssAttr("break-before");return a?Kb.getBefore(a):null},_loadBreakAfter:function(){var a=this.getCssAttr("break-after");return a?Kb.getAfter(a):null},_loadListStyle:function(){var a=this.getCssAttr("list-style-type","none");return"none"===a?null:new R({type:a,position:this.getCssAttr("list-style-position","outside"),image:this.getCssAttr("list-style-image","none")})},_loadLetterSpacing:function(a){var b=this.getCssAttr("letter-spacing");return b?this._computeUnitSize(b,a):void 0},_loadStaticMeasure:function(){var a=this.flow.getPropMeasure(),b=this.getAttr(a)||this.getAttr("measure")||this.getCssAttr(a)||this.getCssAttr("measure");return b?this._computeUnitSize(b,this.font.size):null},_loadStaticExtent:function(){var a=this.flow.getPropExtent(),b=this.getAttr(a)||this.getAttr("extent")||this.getCssAttr(a)||this.getCssAttr("extent");return b?this._computeUnitSize(b,this.font.size):null}},a}(),Qb=function(){function a(a,b){this.block=a,this.inline=b}return a.prototype={isBlockSpaceLeft:function(){return this.block.isSpaceLeft()},hasBlockSpaceFor:function(a){return this.block.hasSpaceFor(a)},hasBreakAfter:function(){return this.block.hasBreakAfter()||this.inline.hasBreakAfter()||!1},addBlockElement:function(a,b){this.block.addElement(a,b)},pushBlockElement:function(a,b){this.block.pushElement(a,b)},pullBlockElement:function(a,b){this.block.pullElement(a,b)},getBlockElements:function(){return this.block.getElements()},getBlockCurExtent:function(){return this.block.getCurExtent()},getBlockMaxExtent:function(){return this.block.getMaxExtent()},getBlockRestExtent:function(){return this.block.getRestExtent()},isInlineEmpty:function(){return this.inline.isEmpty()},isInlineSpaceLeft:function(){return this.inline.isSpaceLeft()},hasInlineSpaceFor:function(a){return this.inline.hasSpaceFor(a)},hasLineBreak:function(){return this.inline.hasLineBreak()},setLineBreak:function(a){this.inline.setLineBreak(a)},setBreakAfter:function(a){this.inline.setBreakAfter(a)},addInlineElement:function(a,b){this.inline.addElement(a,b)},getInlineLastText:function(){return this.inline.getLastText()},getInlineTexts:function(){return this.inline.getTexts()},getInlineElements:function(){return this.inline.getElements()},getInlineCurMeasure:function(){return this.inline.getCurMeasure()},getInlineRestMeasure:function(){return this.inline.getRestMeasure()},getInlineMaxMeasure:function(){return this.inline.getMaxMeasure()},getInlineMaxExtent:function(){return this.inline.getMaxExtent()},getInlineMaxFontSize:function(){return this.inline.getMaxFontSize()},getInlineCharCount:function(){return this.inline.getCharCount()},justify:function(a){return this.inline.justify(a)}},a}(),Rb=function(){function a(a){this.curExtent=0,this.maxExtent=a,this.pushedElements=[],this.elements=[],this.pulledElements=[],this.breakAfter=!1}return a.prototype={isSpaceLeft:function(){return this.getRestExtent()>0},hasSpaceFor:function(a){return this.getRestExtent()>=a},hasBreakAfter:function(){return this.breakAfter},_onAddElement:function(a,b){this.curExtent+=b,a.breakAfter&&(this.breakAfter=!0)},addElement:function(a,b){this.elements.push(a),this._onAddElement(a,b)},pushElement:function(a,b){this.pushedElements.push(a),this._onAddElement(a,b)},pullElement:function(a,b){this.pulledElements.unshift(a),this._onAddElement(a,b)},getCurExtent:function(){return this.curExtent},getRestExtent:function(){return this.maxExtent-this.curExtent},getMaxExtent:function(){return this.maxExtent},getElements:function(){return this.pulledElements.concat(this.elements).concat(this.pushedElements)}},a}(),Sb=function(){function a(a){this.charCount=0,this.curMeasure=0,this.maxMeasure=a,this.maxExtent=0,this.maxFontSize=0,this.elements=[],this.texts=[],this.lineBreak=!1,this.breakAfter=!1}return a.prototype={isEmpty:function(){return!this.lineBreak&&!this.breakAfter&&0===this.elements.length},isSpaceLeft:function(){return this.getRestMeasure()>0},hasSpaceFor:function(a){return this.getRestMeasure()>=a},hasLineBreak:function(){return this.lineBreak},setLineBreak:function(a){this.lineBreak=a},hasBreakAfter:function(){return this.breakAfter},setBreakAfter:function(a){this.breakAfter=a},addElement:function(a,b){this.elements.push(a),D.isText(a)?(this.texts.push(a),a.getCharCount&&(this.charCount+=a.getCharCount())):a instanceof nb&&(this.maxExtent=a.maxExtent?Math.max(this.maxExtent,a.maxExtent):Math.max(this.maxExtent,a.getLayoutExtent()),a.maxFontSize&&(this.maxFontSize=Math.max(this.maxFontSize,a.maxFontSize)),a.breakAfter&&(this.breakAfter=!0)),this.curMeasure+=b},getLastText:function(){return i.last(this.texts)},getTexts:function(){return this.texts},getElements:function(){return this.elements},getCurMeasure:function(){return this.curMeasure},getRestMeasure:function(){return this.maxMeasure-this.curMeasure},getMaxMeasure:function(){return this.maxMeasure},getMaxExtent:function(){return this.maxExtent},getMaxFontSize:function(){return this.maxFontSize},getCharCount:function(){return this.charCount},getLastChar:function(){return i.last(this.texts)},justify:function(a){for(var b,c=this.texts.length-1,d=c;d>=0&&(b=this.texts[d],a&&a.isHeadNg&&a.isHeadNg()||b.isTailNg&&b.isTailNg());)a=b,d--;return d>=0&&c>d?(this.elements=i.filter(this.elements,function(a){return a.pos?a.pos<=b.pos:!0}),b):null}},a}(),Tb=function(){function a(a,b){this.style=a,this.stream=b,this._parentLayout=null,this._childLayout=null,this._cachedElements=[],this._terminate=!1}return a.prototype.yield=function(a){var b=a?this._createChildContext(a):this._createStartContext();return this._yield(b)},a.prototype._yield=function(){throw"LayoutGenerator::_yield must be implemented in child class"},a.prototype.setTerminate=function(a){this._terminate=a},a.prototype.setChildLayout=function(a){this._childLayout=a,a._parentLayout=this},a.prototype.hasNext=function(){return this._terminate?!1:this.hasCache()?!0:this.hasChildLayout()?!0:this.stream?this.stream.hasNext():!1},a.prototype.hasChildLayout=function(){return this._childLayout&&this._childLayout.hasNext()?!0:!1},a.prototype.hasCache=function(){return this._cachedElements.length>0},a.prototype.yieldChildLayout=function(a){var b=this._childLayout.yield(a);return b},a.prototype.peekLastCache=function(){return i.last(this._cachedElements)},a.prototype.pushCache=function(a){var b=a.cacheCount||0;return b>0&&b>=c.maxRollbackCount?(console.error("[%s] too many cache count(%d), force terminate:%o",this.style.getMarkupName(),b,this.style),void this.setTerminate(!0)):(a.cacheCount=b+1,void this._cachedElements.push(a))},a.prototype.popCache=function(){var a=this._cachedElements.pop();return a},a.prototype.clearCache=function(){this._cachedElements=[]},a.prototype._onAddElement=function(){},a.prototype._onCreate=function(){},a.prototype._onComplete=function(){},a.prototype._createStartContext=function(){return new Qb(new Rb(this.style.contentExtent),new Sb(this.style.contentMeasure))},a.prototype._createChildContext=function(a){return new Qb(new Rb(a.getBlockRestExtent()-this.style.getEdgeExtent()),new Sb(this.style.contentMeasure))},a.prototype._createStream=function(a){switch(a.getMarkupName()){case"ruby":return new Cb(a.markup);default:return new xb(a.getContent())}},a.prototype._createFloatGenerator=function(a,b,c){var d=this,e=this.style,f=this.stream.mapWhile(function(c){if(!D.isTag(c))return null;var f=new Pb(c,e,{layoutContext:a});if(!f.isFloated())return e.removeChild(f),null;var g=d._createStream(f);return d._createChildBlockGenerator(f,g,a,b)}),g=[c].concat(f);return new cc(this.style,this.stream,b,g)},a.prototype._createChildBlockGenerator=function(a,b,c,d){if(a.hasFlipFlow())return new _b(a,b,d,c);if(a.isPasted())return new Zb(a,a.createBlock({content:a.getContent()}));switch(a.display){case"list-item":return new hc(a,b,d);case"table":return new ic(a,b,d);case"table-header-group":case"table-row-group":case"table-footer-group":return new jc(a,b,d);case"table-row":return new kc(a,b,d);case"table-cell":return new lc(a,b)}switch(a.getMarkupName()){case"img":return new Zb(a,a.createImage());case"hr":return new Zb(a,a.createBlock());case"first-line":return new Yb(a,b,d);case"details":case"blockquote":case"figure":case"fieldset":return new ec(a,b);case"section":case"article":case"nav":case"aside":return new fc(a,b,d);case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return new mc(a,b,d);case"ul":case"ol":return new gc(a,b,d);default:return new Ub(a,b,d)}},a.prototype._createChildInlineGenerator=function(a,b,c,d){if(a.isInlineBlock())return new Wb(a,b,d);if(a.isPasted())return new Zb(a,a.createLine({content:a.getContent()}));switch(a.getMarkupName()){case"img":return new Zb(a,a.createImage());case"a":return new Xb(a,b,d);case"page-break":case"end-page":case"pbr":return new $b(a);default:return new Vb(a,b,d)}},a}(),Ub=function(){function a(a,b,c){Tb.call(this,a,b),this.outlineContext=c}return h.extend(a,Tb),a.prototype._yield=function(a){if(!a.isBlockSpaceLeft())return null;for(;this.hasNext();){var b=this._getNext(a);if(null===b)break;var c=b.getLayoutExtent(this.style.flow);if(!a.hasBlockSpaceFor(c)){this.pushCache(b);break}if(this._addElement(a,b,c),!a.isBlockSpaceLeft()||a.hasBreakAfter())break}return this._createOutput(a)},a.prototype.popCache=function(a){var b=Tb.prototype.popCache.call(this);return b&&"inline"===b.display&&b.getLayoutMeasure(this.style.flow)<this.style.contentMeasure&&!b.br?(this._childLayout.rollback(b),this.yieldChildLayout(a)):b},a.prototype._getNext=function(a){if(this.hasCache()){var b=this.popCache(a);return b}if(this.hasChildLayout()){var c=this.yieldChildLayout(a);return c}var d=this.stream?this.stream.get():null;if(null===d)return null;if(D.isText(d))return D.isWhiteSpace(d)?(this.stream.skipUntil(D.isWhiteSpace),this._getNext(a)):(this.stream.prev(),this.setChildLayout(new Vb(this.style,this.stream,this.outlineContext)),this.yieldChildLayout(a));var e=new Pb(d,this.style,{layoutContext:a});if(e.isDisabled())return this.style.removeChild(e),this._getNext(a);var f=this._createStream(e);if(e.isFloated()){var g=this._createChildBlockGenerator(e,f,a,this.outlineContext);return this.setChildLayout(this._createFloatGenerator(a,this.outlineContext,g)),this.yieldChildLayout(a)}if(e.isInlineBlock()||e.isInline()){var h=this._createChildInlineGenerator(e,f,a,this.outlineContext);return this.setChildLayout(new Vb(this.style,this.stream,this.outlineContext,h)),this.yieldChildLayout(a)}return this.setChildLayout(this._createChildBlockGenerator(e,f,a,this.outlineContext)),this.yieldChildLayout(a)},a.prototype._addElement=function(a,b,c){null!==b&&(this.style.isPushed()||b.pushed?a.pushBlockElement(b,c):this.style.isPulled()||b.pulled?a.pullBlockElement(b,c):a.addBlockElement(b,c),this._onAddElement(b))},a.prototype._createOutput=function(a){var b=a.getBlockCurExtent(),c=a.getBlockElements();if(0===b||0===c.length)return null;var d=this.style.createBlock({extent:b,elements:c,breakAfter:a.hasBreakAfter()});return this._onCreate(a,d),this.hasNext()||this._onComplete(a,d),d},a}(),Vb=function(){function a(a,b,c,d){Tb.call(this,a,b),this.outlineContext=c||null,d&&this.setChildLayout(d)}h.extend(a,Tb);var b=function(a){var b=a.elements[0];return b instanceof nb?b.style.getMarkupPos():b.pos};return a.prototype._yield=function(a){if(!a.isInlineSpaceLeft())return null;for(;this.hasNext();){var b=this._getNext(a);if(null===b)break;var c=this._getMeasure(b);if(0===c)break;if(!a.hasInlineSpaceFor(c)){this.pushCache(b);break}if(this._addElement(a,b,c),!a.isInlineSpaceLeft())break}return this._createOutput(a)},Tb.prototype.rollback=function(a){if(null!==this.stream){var c=a instanceof nb?b(a):a.pos;this.stream.setPos(c);var d=this.popCache();this._childLayout&&d&&this._childLayout.rollback(d)}},a.prototype._createChildContext=function(a){return new Qb(a.block,new Sb(a.getInlineRestMeasure()))},a.prototype._createOutput=function(a){if(a.isInlineEmpty())return null;!a.hasLineBreak()&&c.justify&&this._justifyLine(a);var b=this.style.createLine({lineBreak:a.hasLineBreak(),breakAfter:a.hasBreakAfter(),measure:a.getInlineCurMeasure(),elements:a.getInlineElements(),texts:a.getInlineTexts(),charCount:a.getInlineCharCount(),maxExtent:a.getInlineMaxExtent(),maxFontSize:a.getInlineMaxFontSize()});return this._onCreate(a,b),this.hasNext()||this._onComplete(a,b),b},a.prototype._justifyLine=function(a){var b=this.peekLastCache()||this.stream.peek(),c=a.justify(b);c&&(this.stream.setPos(c.pos+1),this.clearCache())},a.prototype._getNext=function(a){if(this.hasCache()){var b=this.popCache(a);return b}if(this.hasChildLayout())return this.yieldChildLayout();var c=this.stream.get();if(null===c)return null;if(D.isText(c))return"horizontal"===this.style.getTextCombine()?this._getTcy(a,c):D.isWhiteSpace(c)?this._getWhiteSpace(a,c):this._getText(a,c);var d=this.style;if(c instanceof C&&(d=new Pb(c,this.style,{layoutContext:a})),d.isDisabled())return this._getNext(a);var e=this._createStream(d);if(d.isBlock()||d.isFloated()){var f=this._createChildBlockGenerator(d,e,a,this.outlineContext);return d.isFloated()&&(f=this._createFloatGenerator(a,this.outlineContext,f)),this._breakInline(f),a.setLineBreak(!0),null}if(d.isInlineBlock())return new Wb(d,e,this.outlineContext).yield(a);switch(d.getMarkupName()){case"img":return d.createImage();case"br":return a.setLineBreak(!0),null;default:var g=this._createChildInlineGenerator(d,e,a,this.outlineContext);return this.setChildLayout(g),this.yieldChildLayout(a)}},a.prototype._breakInline=function(b){this.setTerminate(!0),null!==this._parentLayout&&(this._parentLayout instanceof a?this._parentLayout._breakInline(b):this._parentLayout.setChildLayout(b))},a.prototype._getTcy=function(a){this.setTerminate(!0);var b=new G(this.style.getMarkupContent());return this._getText(a,b)},a.prototype._getWhiteSpace=function(a,b){return this.style.isPre()?D.isNewLine(b)?null:this._getText(a,b):(this.stream.skipUntil(D.isNewLine),D.isNewLine(b)?this._getNext(a):this._getText(a,b))},a.prototype._getText=function(a,b){if(b.hasMetrics()||this._setTextMetrics(a,b),b instanceof H)return b;switch(b._type){case"char":case"tcy":return b;case"word":return this._getWord(a,b)}},a.prototype._setTextMetrics=function(a,b){b instanceof E&&c.kerning&&this._setCharKerning(a,b),b.setMetrics(this.style.flow,this.style.font)},a.prototype._setCharKerning=function(a,b){var c=this.stream.peek(),d=a.getInlineLastText(),e=c&&D.isText(c)?c:null;Gb.set(b,d,e)},a.prototype._getWord=function(a,b){var c=a.getInlineRestMeasure(),d=b.getAdvance(this.style.flow,this.style.letterSpacing||0);if(c>=d)return b.setDevided(!1),b;var e=b.cutMeasure(this.style.getFontSize(),c);return e.setMetrics(this.style.flow,this.style.font),b.setMetrics(this.style.flow,this.style.font),""!==b.data&&b.bodySize>0&&this.stream.prev(),e.bodySize=Math.min(c,e.bodySize),e},a.prototype._getMeasure=function(a){return a instanceof nb?a.getLayoutMeasure(this.style.flow):a.getAdvance?a.getAdvance(this.style.flow,this.style.letterSpacing||0):0},a.prototype._addElement=function(a,b,c){a.addInlineElement(b,c),this._onAddElement(b)},a}(),Wb=function(){function a(a,b,c){Ub.call(this,a,b,c)}return h.extend(a,Ub),a.prototype._onCreate=function(a,b){var c=i.maxobj(b.elements,function(a){return a.getContentMeasure()});return c&&b.size.setMeasure(this.style.flow,c.getContentMeasure()),b},a.prototype._createChildContext=function(a){return new Qb(new Rb(a.getBlockRestExtent()-this.style.getEdgeExtent()),new Sb(a.getInlineRestMeasure()-this.style.getEdgeMeasure()))},a}(),Xb=function(){function a(a,c,d){Vb.call(this,a,c,d),b(a)}var b=function(a){var b=a.getMarkupAttr("name");b&&wb.addAnchor(b)};return h.extend(a,Vb),a.prototype._onComplete=function(){b(this.style)},a}(),Yb=function(){function a(a,b,c){Ub.call(this,a,b,c)}return h.extend(a,Ub),a.prototype._onAddElement=function(a){"inline"===a.display&&"undefined"==typeof this._first&&(this._first=!0,this.style=this.style.parent,this._childLayout&&(this._childLayout.style=this.style))},a}(),Zb=function(){function a(a,b){Tb.call(this,a,null),this.output=b}return h.extend(a,Tb),a.prototype.hasNext=function(){return!this._terminate},a.prototype.yield=function(){return this._terminate?null:(this._terminate=!0,this.output)},a}(),$b=function(){function a(a){Vb.call(this,a,null,null)}return h.extend(a,Vb),a.prototype.hasNext=function(){return!this._terminate},a.prototype._yield=function(a){return a.setBreakAfter(!0),this._terminate=!0,this.style.createBreakLine()},a}(),_b=function(){function a(a,b,c){Ub.call(this,a,b,c)}return h.extend(a,Ub),a.prototype.yield=function(a){return this.style.updateContextSize(a.getBlockRestExtent(),a.getInlineMaxMeasure()),Ub.prototype.yield.call(this)},a}(),ac=function(){function a(a,b){this.elements=a||[],this.floatDirection=b||Ib.get("start")}return a.prototype={add:function(a){this.elements.unshift(a)},isFloatStart:function(){return this.floatDirection.isStart()},isFloatEnd:function(){return this.floatDirection.isEnd()},getElements:function(){return this.isFloatStart()?this.elements:i.reverse(this.elements)},getMeasure:function(a){return i.fold(this.elements,0,function(b,c){return b+c.getLayoutMeasure(a)})},getExtent:function(a){return i.fold(this.elements,0,function(b,c){return Math.max(b,c.getLayoutExtent(a))})}},a}(),bc=function(){function a(a,b,d){var e=c(a,Ib.get("start"),b),f=c(a,Ib.get("end"),d);this.stack=e.concat(f).sort(function(b,c){return b.getExtent(a)-c.getExtent(a)})}var b=function(a,b,c){var d=c.pop()||null;if(null===d)return null;for(var e=d.getLayoutExtent(a),f=new ac([d],b);;){var g=c.pop();if(!(g&&g.getLayoutExtent(a)<=e)){c.push(g);break}f.add(g)}return f},c=function(a,c,d){var e,f=[];do e=b(a,c,d),e&&f.push(e);while(null!==e);return f};return a.prototype={isEmpty:function(){return 0===this.stack.length},pop:function(){return this.stack.pop()||null}},a}(),cc=function(){function a(a,b,c,d){Ub.call(this,a,b,c),this.generators=d,this.setChildLayout(new Ub(a.clone({"float":"start"}),b,c))}return h.extend(a,Tb),a.prototype.hasNext=function(){return this._hasNextFloat()?!0:Tb.prototype.hasNext.call(this)},a.prototype._hasNextFloat=function(){return i.exists(this.generators,function(a){return a.hasNext()})},a.prototype._yield=function(a){var b=this._yieldFloatStack(a),c=a.getInlineRestMeasure(),d=a.getBlockRestExtent();return this._yieldFloat(a,b,c,d)},a.prototype._yieldFloat=function(a,b,c,d){if(0>=c)return null;var e=this.style.flow;if(b.isEmpty())return this._yieldFloatSpace(a,c,d);var f=b.pop(),g=this._yieldFloat(a,b,c-f.getMeasure(e),f.getExtent(e)),h=this._wrapFloat(f,g,c),i=d-f.getExtent(e);if(0>=i||!this.stream.hasNext())return h;var j=this._yieldFloatSpace(a,c,i);return this._wrapBlock(h,j)},a.prototype._sortFloatRest=function(a,b){var c=a.getElements();return a.isFloatStart()?c.concat(b):[b].concat(c)},a.prototype._wrapBlock=function(a,b){var c=this.style.flow,d=a.getLayoutMeasure(c),e=a.getLayoutExtent(c)+(b?b.getLayoutExtent(c):0),f=b?[a,b]:[a],g=i.exists(f,function(a){return a&&a.breakAfter?!0:!1});return this.style.createChild("div",{"float":"start",measure:d}).createBlock({elements:f,breakAfter:g,extent:e})},a.prototype._wrapFloat=function(a,b,c){var d=this.style.flow,e=a.getExtent(d),f=this._sortFloatRest(a,b),g=i.exists(f,function(a){return a&&a.breakAfter?!0:!1});return this.style.createChild("div",{"float":"start",measure:c}).createBlock({elements:f,breakAfter:g,extent:e})},a.prototype._yieldFloatSpace=function(a,b,c){return this._childLayout.style.updateContextSize(b,c),this.yieldChildLayout()},a.prototype._yieldFloatStack=function(a){var b=[],c=[];return i.iter(this.generators,function(d){var e=d.yield(a);e&&(d.style.isFloatStart()?b.push(e):d.style.isFloatEnd()&&c.push(e))}),new bc(this.style.flow,b,c)},a}(),dc=function(){function a(a,b){Tb.call(this,a,null),this.generators=b}return h.extend(a,Tb),a.prototype._yield=function(a){if(this.hasCache())return this.popCache();var b=this._yieldParallelBlocks(a);if(null===b)return null;var c=this._wrapBlocks(b),d=c.getLayoutExtent(this.style.flow);return a.hasBlockSpaceFor(d)?(a.addBlockElement(c,d),c):(this.pushCache(c),null)},a.prototype.hasNext=function(){return this._terminate?!1:this.hasCache()?!0:i.exists(this.generators,function(a){return a.hasNext()})},a.prototype._yieldParallelBlocks=function(a){var b=i.map(this.generators,function(b){return b.yield(a)});return i.forall(b,function(a){return null===a})?null:b},a.prototype._findMaxBlock=function(a){var b=this.style.flow;return i.maxobj(a,function(a){return a?a.getLayoutExtent(b):0})},a.prototype._alignContentExtent=function(a,b){var c=this.style.flow,d=this.generators;return i.mapi(a,function(a,e){return null===e?d[a].style.createBlock({elements:[],extent:b}):e.resizeExtent(c,b)})},a.prototype._wrapBlocks=function(a){var b=this.style.flow,c=(this.generators,this._findMaxBlock(a)),d=this._alignContentExtent(a,c.getContentExtent(b));return this.style.createBlock({elements:d,extent:c.getLayoutExtent(b)})},a}(),ec=function(){function a(a,b){Ub.call(this,a,b),this.outlineContext=new sb(a)}return h.extend(a,Ub),a.prototype._onComplete=function(){wb.addOutlineContext(this.outlineContext)},a}(),fc=function(){function a(a,b,c){Ub.call(this,a,b,c),this.outlineContext.startSection(this.style.getMarkupName())}return h.extend(a,Ub),a.prototype._onComplete=function(){this.outlineContext.endSection(this.style.getMarkupName())},a}(),gc=function(){function a(a,b,c){Ub.call(this,a,b,c),this.style.markerSize=this._getMarkerSize(this.stream.getTokenCount())}return h.extend(a,Ub),a.prototype._getMarkerSize=function(a){var b=this.style.getMarkerHtml(a),c=new Vb(this.style.clone(),new xb(b)),d=c.yield(),e=d?d.inlineMeasure+Math.floor(this.style.getFontSize()/2):this.style.getFontSize(),f=d?d.size.getExtent(this.style.flow):this.style.getFontSize();return this.style.flow.getBoxSize(e,f)},a}(),hc=function(){function a(a,b,c){dc.call(this,a,[this._createListMarkGenerator(a,c),this._createListBodyGenerator(a,b,c)])}return h.extend(a,dc),a.prototype._createListMarkGenerator=function(a,b){var c=a.parent.markerSize||a.flow.getBoxSize(2*d.fontSize,d.fontSize),e=a.getChildIndex(),f=a.parent.getMarkerHtml(e+1),g=c.getMeasure(a.flow),h=a.createChild("li-marker",{"float":"start","class":"nehan-li-marker",measure:g});return new Ub(h,new xb(f),b)},a.prototype._createListBodyGenerator=function(a,b,c){var e=a.parent.markerSize||a.flow.getBoxSize(2*d.fontSize,d.fontSize),f=a.contentMeasure-e.getMeasure(a.flow),g=a.createChild("li-body",{"float":"start","class":"nehan-li-body",measure:f});return new Ub(g,b,c)},a.prototype._alignContentExtent=function(a,b){return dc.prototype._alignContentExtent.call(this,a,b)},a}(),ic=function(){function a(a,b){Ub.call(this,a,b)}return h.extend(a,Ub),a}(),jc=function(){function a(a,b,c){Ub.call(this,a,b,c)}return h.extend(a,Ub),a}(),kc=function(){function a(a,b,c){var d=this._getGenerators(a,b,c);dc.call(this,a,d)}return h.extend(a,dc),a.prototype._getGenerators=function(a,b,c){var d=this._getChildTags(b),e=this._getChildStyles(a,d);return i.map(e,function(a){return new lc(a,new xb(a.getMarkupContent()),c)})},a.prototype._getChildStyles=function(a,b){var c=b.length,d=a.contentMeasure;return i.mapi(b,function(b,e){var f=new Pb(e,a),g=f.staticMeasure,h=g&&d>=g?g:Math.floor(d/(c-b));return d-=h,f.clone({"float":"start",measure:h})})},a.prototype._getChildTags=function(a){return a.getAllIf(function(a){return a instanceof C&&("td"===a.getName()||"th"===a.getName())})},a}(),lc=function(){function a(a,b){ec.call(this,a,b),this.outlineContext=new sb(a)}return h.extend(a,ec),a}(),mc=function(){function a(a,b,c){Ub.call(this,a,b,c)}return h.extend(a,Ub),a.prototype._getHeaderRank=function(){return this.style.getMarkupName().match(/h([1-6])/)?parseInt(RegExp.$1,10):0},a.prototype._onComplete=function(a,b){var c=this.outlineContext.addHeader({type:this.style.getMarkupName(),rank:this._getHeaderRank(),title:this.style.getMarkupContent()});b.id=o.addNehanHeaderPrefix(c)},a}(),nc=function(){function a(a){var b=new C("<body>",a);ec.call(this,new Pb(b,null),new xb(a))}return h.extend(a,ec),a.prototype._onCreate=function(a,b){b.seekPos=this.stream.getSeekPos(),b.charPos=wb.charPos,b.percent=this.stream.getSeekPercent(),b.pageNo=wb.pageNo++,wb.charPos+=b.charCount||0,wb.pageNo>c.maxPageCount&&this.setTerminate(!0)},a}(),oc=function(){function a(a){this.stream=new Ab(a),this.generator=this._createGenerator()}return a.prototype={"yield":function(){return this.generator.yield()},hasNext:function(){return this.generator.hasNext()},setTerminate:function(a){this.generator.setTerminate(a)},_createGenerator:function(){for(;this.stream.hasNext();){var a=this.stream.get();
switch(a.getName()){case"head":this._parseDocumentHeader(new Bb(a.getContent()));break;case"body":return this._createBodyGenerator(a.getContent())}}return this._createBodyGenerator(this.stream.getSrc())},_createBodyGenerator:function(a){return new nc(a)},_parseDocumentHeader:function(a){for(var b=new vb;a.hasNext();){var c=a.get();switch(c.getName()){case"title":b.setTitle(c.getContent());break;case"meta":b.addMeta(c);break;case"link":b.addLink(c);break;case"style":b.addStyle(c);break;case"script":b.addScript(c)}}wb.documentHeader=b}},a}(),pc=function(){function a(a){this.stream=new zb(a),this.generator=this._createGenerator()}return a.prototype={"yield":function(){return this.generator.yield()},hasNext:function(){return this.generator.hasNext()},setTerminate:function(a){this.generator.setTerminate(a)},_createGenerator:function(){for(;this.stream.hasNext();){var a=this.stream.get();switch(a.getName()){case"!doctype":wb.documentType="html";break;case"html":return this._createHtmlGenerator(a)}}var b=new C("<html>",this.stream.getSrc());return this._createHtmlGenerator(b)},_createHtmlGenerator:function(a){return new oc(a.getContent())}},a}(),qc=function(){function a(){}return a.prototype={_createElement:function(a,b){b=b||{};var c=b.styles||{},d=b.attrs?b.attrs instanceof B?b.attrs.attrs:b.attrs:{},e=b.attrs?b.attrs.dataset:{},f=document.createElement(a);return b.id&&(f.id=b.id),b.className&&(f.className=b.className),b.content&&(f.innerHTML=b.content),j.iter(c,function(a,b){f.style[k.camelize(a)]=b}),j.iter(d,function(a,b){"class"!==a&&(f[a]=b)}),r.copy(f.dataset,e),b.oncreate&&b.oncreate(f),f},_createClearFix:function(a){var b=document.createElement("div");return b.style.clear=a||"both",b},evaluate:function(a){return this.isFlipTree(a)?this.evalFlip(a):this.evalTree(a)},evalTree:function(a,b){b=b||{};var c=this,d=i.filter(b.elements||a.elements,function(a){return null!==a}),e=b.root||this.evalTreeRoot(a,b);return e.innerHTML?e:i.fold(d,e,function(b,d){return e.appendChild(c.evalTreeChild(a,d)),d.withBr&&e.appendChild(document.createElement("br")),d.withClearFix&&e.appendChild(c._createClearFix()),e})},evalTreeRoot:function(a,b){return b=b||{},this._createElement(b.name||"div",{className:a.getClassName(),attrs:a.getAttrs(),oncreate:a.getOnCreate(),content:b.content||a.getContent(),styles:b.css||a.getCssRoot()})},evalTreeChild:function(a,b){switch(a.display){case"inline":return b instanceof nb?this.evalInlineChildElement(a,b):this.evalInlineChildText(a,b);default:return this.evalBlockChildElement(a,b)}},evalBlockChildElement:function(a,b){switch(b.style.getMarkupName()){case"img":return this.evalImage(b);case"a":return this.evalLink(b);default:return this.evaluate(b)}},evalInlineChildElement:function(a,b){switch(b.style.getMarkupName()){case"img":return this.evalInlineImage(a,b);case"a":return this.evalLink(b);default:return this.evalInlineChildTree(b)}},evalInlineChildText:function(a,b){return a.style.isTextEmphaEnable()?this.evalEmpha(a,b):this.evalTextElement(a,b)},evalImage:function(a){return this.evalTreeRoot(a,{name:"img"})},evalInlineImage:function(a,b){return this.evalImage(b)},evalLink:function(a){var b=new jb(a.style.getMarkupAttr("href")),c=b.getAnchorName();if(c){var d=wb.getAnchorPageNo(c);a.classes.push("nehan-anchor-link"),a.style.markup.setAttr("data-page",d)}return this.evalTree(a,{name:"a"})},evalTextElement:function(a,b){switch(b._type){case"word":return this.evalWord(a,b);case"char":return this.evalChar(a,b);case"tcy":return this.evalTcy(a,b);case"ruby":return this.evalRuby(a,b);default:throw console.error("invalid text element:%o",b),"invalid text element"}}},a}(),rc=function(){function a(){qc.call(this)}return h.extend(a,qc),a.prototype.isFlipTree=function(a){return a.style.isTextHorizontal()},a.prototype.evalFlip=function(a){return(new sc).evaluate(a)},a.prototype.evalInlineChildTree=function(a){return this.evalTree(a)},a.prototype.evalInlineImage=function(a,b){return b.withBr=!0,this.evalTreeRoot(b,{name:"img",styles:b.getCssInline()})},a.prototype.evalRuby=function(a,b){var c=this._createElement("div",{className:"nehan-ruby-body"});return c.appendChild(this.evalRb(a,b)),c.appendChild(this.evalRt(a,b)),c},a.prototype.evalRb=function(a,b){return this.evalTree(a,{elements:b.getRbs(),root:this._createElement("div",{styles:b.getCssVertRb(a),className:"nehan-rb"})})},a.prototype.evalRt=function(a,b){var c=new Vb(new Pb(b.rt,a.style),new xb(b.getRtString()),null).yield();return r.copy(c.css,b.getCssVertRt(a)),this.evaluate(c)},a.prototype.evalWord=function(a,b){return e.isTransformEnable?e.isTrident?this.evalWordTransformTrident(a,b):this.evalWordTransform(a,b):e.isIE?this.evalWordIE(a,b):""},a.prototype.evalWordTransform=function(a,b){var c=this._createElement("div",{styles:b.getCssVertTrans(a)}),d=this._createElement("div",{content:b.data,className:"nehan-rotate-90",styles:b.getCssVertTransBody(a)});return c.appendChild(d),c},a.prototype.evalWordTransformTrident=function(a,b){var c=this._createElement("div",{styles:b.getCssVertTrans(a)}),d=this._createElement("div",{content:b.data,styles:b.getCssVertTransBodyTrident(a)});return c.appendChild(d),c},a.prototype.evalWordIE=function(a,b){return this._createElement("div",{content:b.data,className:"nehan-vert-ie",styles:b.getCssVertTransIE(a)})},a.prototype.evalRotateChar=function(a,b){return e.isTransformEnable?this.evalRotateCharTransform(a,b):e.isIE?this.evalRotateCharIE(a,b):this.evalCharWithBr(a,b)},a.prototype.evalRotateCharTransform=function(a,b){return this._createElement("div",{content:b.getData(),className:"nehan-rotate-90"})},a.prototype.evalRotateCharIE=function(a,b){return this._createElement("div",{content:b.getData(),className:"nehan-vert-ie",styles:b.getCssVertRotateCharIE(a)})},a.prototype.evalTcy=function(a,b){return this._createElement("div",{content:b.data,className:"nehan-tcy"})},a.prototype.evalChar=function(a,b){return b.isImgChar()?b.isVertGlyphEnable()?this.evalVerticalGlyph(a,b):this.evalImgChar(a,b):b.isHalfSpaceChar(b)?this.evalHalfSpaceChar(a,b):b.isRotateChar()?this.evalRotateChar(a,b):b.isSmallKana()?this.evalSmallKana(a,b):b.isPaddingEnable()?this.evalPaddingChar(a,b):a.letterSpacing?this.evalCharLetterSpacing(a,b):this.evalCharWithBr(a,b)},a.prototype.evalCharWithBr=function(a,b){return b.withBr=!0,document.createTextNode(p.unescape(b.getData()))},a.prototype.evalCharLetterSpacing=function(a,b){return this._createElement("div",{content:b.getData(),styles:b.getCssVertLetterSpacing(a)})},a.prototype.evalEmpha=function(a,b){var c=this._createElement("span",{content:b.getData(),className:"nehan-empha-src",styles:b.getCssVertEmphaTarget(a)}),d=this._createElement("span",{content:a.style.textEmpha.getText(),className:"nehan-empha-text",styles:b.getCssVertEmphaText(a)}),e=this._createElement("div",{className:"nehan-empha-wrap",styles:a.style.textEmpha.getCssVertEmphaWrap(a,b)});return e.appendChild(c),e.appendChild(d),e},a.prototype.evalPaddingChar=function(a,b){return this._createElement("div",{content:b.getData(),styles:b.getCssPadding(a)})},a.prototype.evalImgChar=function(a,b){var c=a.color||new J(d.fontColor),e=c.getRgb(),f=L.getColor(e).toUpperCase();return this._createElement("img",{className:"nehan-img-char",attrs:{src:b.getImgSrc(f)},styles:b.getCssVertImgChar(a)})},a.prototype.evalVerticalGlyph=function(a,b){return this._createElement("div",{content:b.getData(),className:"nehan-vert-glyph",styles:b.getCssVertGlyph(a)})},a.prototype.evalSmallKana=function(a,b){var c=a.style.textEmpha&&a.style.textEmpha.isEnable()?"span":"div";return this._createElement(c,{content:b.getData(),styles:b.getCssVertSmallKana()})},a.prototype.evalHalfSpaceChar=function(a,b){return this._createElement("div",{content:"&nbsp;",styles:b.getCssVertHalfSpaceChar(a)})},a}(),sc=function(){function a(){qc.call(this)}return h.extend(a,qc),a.prototype.isFlipTree=function(a){return a.style.isTextVertical()},a.prototype.evalFlip=function(a){return(new rc).evaluate(a)},a.prototype.evalInlineChildTree=function(a){return this.evalTree(a,{name:"span"})},a.prototype.evalRuby=function(a,b){var c=this._createElement("span",{className:"nehan-ruby-body",styles:b.getCssHoriRuby(a)});return c.appendChild(this.evalRt(a,b)),c.appendChild(this.evalRb(a,b)),c},a.prototype.evalRb=function(a,b){return this.evalTree(a,{elements:b.getRbs(),root:this._createElement("div",{styles:b.getCssHoriRb(a),className:"nehan-rb"})})},a.prototype.evalRt=function(a,b){return this._createElement("div",{content:b.getRtString(),className:"nehan-rt",styles:b.getCssHoriRt(a)})},a.prototype.evalWord=function(a,b){return document.createTextNode(b.data)},a.prototype.evalTcy=function(a,b){return document.createTextNode(p.unescape(b.data))},a.prototype.evalChar=function(a,b){return b.isHalfSpaceChar()?document.createTextNode(b.data):b.isCharRef()?document.createTextNode(p.unescape(b.data)):b.isKerningChar()?this.evalKerningChar(a,b):document.createTextNode(b.data)},a.prototype.evalEmpha=function(a,b){var c=this._createElement("div",{content:b.data,styles:b.getCssHoriEmphaTarget(a)}),d=this._createElement("div",{content:a.style.textEmpha.getText(),styles:b.getCssHoriEmphaText(a)}),e=this._createElement("span",{styles:a.style.textEmpha.getCssHoriEmphaWrap(a,b)});return e.appendChild(d),e.appendChild(c),e},a.prototype.evalKerningChar=function(a,b){var c=b.getCssPadding(a);return b.isKakkoStart()?(c["margin-left"]="-0.5em",this._createElement("span",{content:b.data,className:"nehan-char-kakko-start",styles:c})):b.isKakkoEnd()?(c["margin-right"]="-0.5em",this._createElement("span",{content:b.data,className:"nehan-char-kakko-end",styles:c})):b.isKutenTouten()?(c["margin-right"]="-0.5em",this._createElement("span",{content:b.data,className:"nehan-char-kuto",styles:c})):document.createTextNode(b.data)},a.prototype.evalPaddingChar=function(a,b){return this._createElement("span",{content:b.data,styles:b.getCssPadding(a)})},a}();return Nehan.version="5.0.2",Nehan.Class=h,Nehan.Env=e,r.copy(c,b.config||{}),r.copy2(d,b.layout||{}),z.setValues(Nehan.style||{}),z.setValues(b.style||{}),f.addSingleTagAll(Nehan.__single_tags__),f.addSingleTagRexAll(Nehan.__single_tags_rex__),{documentContext:wb,createPageStream:function(a){return new Fb(a)},addSingleTag:function(a){f.addSingleTag(a)},addSingleTagRex:function(){f.addSingleTagRex(name)},setStyle:function(a,b){return z.setValue(a,b),this},setStyles:function(a){return z.setValues(a),this}}};