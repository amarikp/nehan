/*
 source : nehan.js
 version : 1.1.6
 site : http://tategakibunko.mydns.jp/
 blog : http://tategakibunko.blog83.fc2.com/

 Copyright (c) 2010, Watanabe Masaki <lambda.watanabe[at]gmail.com>
 licenced under MIT licence.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/
var Nehan;if(!Nehan){Nehan={}}if(!Nehan.Layout){Nehan.Layout={}}if(!Nehan.TextStream){Nehan.TextStream={}}if(!Nehan.StreamParser){Nehan.StreamParser={}}if(!Nehan.LayoutMapper){Nehan.LayoutMapper={}}if(!Nehan.Env){Nehan.Env={}}if(!Nehan.ParserHook){Nehan.ParserHook={}}(function(){var m={concat:function(r,q){r=(r=="")?"":(r.slice(-1)=="/")?r:r+"/";q=(q=="")?"":(q[0]=="/")?q.substring(1,q.length):q;return r+q}};var n={read:function(s,r,q){for(prop in r){s[prop]=(typeof q[prop]=="undefined")?r[prop]:q[prop]}}};var p={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(t){for(var q=0;q<t.length;q++){var r=t[q].string;var s=t[q].prop;this.versionSearchString=t[q].versionSearch||t[q].identity;if(r){if(r.indexOf(t[q].subString)!=-1){return t[q].identity}}else{if(s){return t[q].identity}}}},searchVersion:function(r){var q=r.indexOf(this.versionSearchString);if(q==-1){return}return parseFloat(r.substring(q+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};p.init();var g={init:function(){var r=p.browser.toLowerCase();var q=p.version;var s=p.OS;this.isIE=(r=="explorer");this.isWin=(s=="Windows");this.isMac=(s=="Mac");this.isVistaOrWin7=(navigator.userAgent.toLowerCase().indexOf("windows nt 6")>=0);if(r=="chrome"){this.canTransform=true}else{if(r=="safari"){this.canTransform=true}else{if(r=="firefox"&&q>=3.5){this.canTransform=true}else{if(this.isIE&&q>=6){this.canTransform=true}else{this.canTransform=false}}}}}};g.init();var d=function(q){var r="";for(prop in q){if(q[prop]!=""){r+=prop+"='"+q[prop]+"' "}}return r};var o=function(q){var r="";for(prop in q){r+=prop+":"+q[prop]+";"}return r};var f=function(s,r,q){return"<"+s+" "+d(r)+(q?" />":" >")};function l(q){n.read(this,{width:700,height:480,fontSize:16,lineHeightRate:1.8,letterSpacingRate:0.1,direction:"vertical",textLayerClassName:"text-layer",charImgRoot:"/img/char",charImgMap:[],charImgColor:"black",kinsokuCharCount:2,headNgChars:["？","】","，",",","》","。","、","・","｣","」","』","）","＞","〉","≫","]","〕","]","］","！","!",") ","々","ゝ","ー","－"],tailNgChars:["【","《","「","『","（","［","[","〔","＜","≪","(","〈"],plusCss:{}},q);if(typeof q.fontFamily!="undefined"){this.fontFamily=q.fontFamily}this.initialize()}l.prototype.initialize=function(){this.direction=this.direction.toLowerCase();this.directionH=(this.direction=="horizontal"||this.direction=="vertical-lr")?"lr":"rl";this.isV=(this.direction=="vertical"||this.direction=="vertical-lr"||this.direction=="vertical-rl");this.baseLineHeight=Math.floor(this.lineHeightRate*this.fontSize);this.baseLetterSpacing=Math.floor(this.letterSpacingRate*this.fontSize);var q=this.baseLineHeight;var r=this.fontSize+this.baseLetterSpacing;this.width=Math.max(q,this.width);this.height=Math.max(r,this.height);this.yohakuHeight=this.baseLineHeight-this.fontSize;this.letterHeight=(this.isV)?this.fontSize+this.baseLetterSpacing:1;this.wrapTag=(this.isV)?"table":"div";this.rubyFontSize=Math.floor(this.fontSize/2);if(this.isV){this.lineCount=Math.floor(this.height/this.letterHeight)-this.kinsokuCharCount}else{this.lineCount=Math.floor(this.width/this.fontSize)-this.kinsokuCharCount}this.wrapCss="";this.wrapCss+="text-align:left;";this.wrapCss+="padding:0;";this.wrapCss+="font-size:"+this.fontSize+"px;";this.wrapCss+="width:"+this.width+"px;";this.wrapCss+="height:"+this.height+"px;";this.wrapCss+="overflow:hidden;";this.wrapCss+="white-space:nowrap;";if(this.isV){this.wrapCss+="border-collapse:collapse;"}else{this.wrapCss+="line-height:1.8em;";this.wrapCss+="letter-spacing:0;"}if(typeof this.fontFamily=="undefined"){this.wrapCss+="font-family:monospace;"}else{if(this.fontFamily==""){this.wrapCss+="font-family:monospace;"}else{this.wrapCss+="font-family:"+this.fontFamily+", monospace;"}}this.wrapCss+=o(this.plusCss)};l.prototype.setHeight=function(q){this.height=q};l.prototype.setWidth=function(q){this.width=q};l.prototype.setCharImgRoot=function(q){this.charImgRoot=q};l.prototype.setCharImgColor=function(q){var r=q.toLowerCase().replace(/#/g,"");if(r=="white"||r=="fff"||r=="ffffff"){this.charImgColor="white"}else{this.charImgColor="black"}};l.prototype.setDirection=function(q){this.direction=q};l.prototype.getDirection=function(){return this.direction};l.prototype.setFontFamily=function(q){this.fontFamily=q};l.prototype.setFontSize=function(q){this.fontSize=q};l.prototype.setLineHeightRate=function(q){this.lineHeightRate=q};l.prototype.setLetterSpacingRate=function(q){this.letterSpacingRate=q};function c(r,q,s){this.buffer=r;this.length=q;this.isEOF=s;this.seekPos=0}c.prototype.getchar=function(){if(this.seekPos<this.buffer.length){var q=this.buffer.substring(this.seekPos,this.seekPos+1);this.seekPos++;return q}else{throw"BufferEnd"}};c.prototype.lookNextChar=function(){if(this.seekPos<this.buffer.length){return this.buffer.substring(this.seekPos,this.seekPos+1)}return""};c.prototype.stepSeekPos=function(){if(this.seekPos<this.buffer.length){this.seekPos++}};c.prototype.getTag=function(){var q="<";while(true){var r=this.getchar();q+=r;if(r==">"){return q}}return""};c.prototype.skipCRLF=function(){var s=this.seekPos;var r=this.lookNextChar();if(r=="\n"){this.seekPos++;return this.seekPos}else{if(r=="\r"){this.seekPos++;var q=this.lookNextChar();if(q=="\n"){this.seekPos++;return this.seekPos}}}return s};c.prototype.getBuffer=function(){return this.buffer};c.prototype.setBuffer=function(r,q){this.buffer=r;this.length=(typeof q!="undefined")?q:r.length;this.isEOF=true};c.prototype.addBuffer=function(q){if(!this.isEOF){this.buffer+=q;if(this.buffer.length>=this.length){this.isEOF=true}}};c.prototype.setEOF=function(q){this.isEOF=q};c.prototype.getEOF=function(){return this.isEOF};function e(q){this.kanji="";this.yomi="";this.seekPos=0;this.rubyStartPos=q;this.ready=false}e.prototype.addKanji=function(q){this.kanji+=q};e.prototype.addYomi=function(q){this.yomi+=q};e.prototype.setReady=function(){this.ready=true};e.prototype.isReady=function(){return this.ready};e.prototype.getchar=function(){if(this.seekPos<this.kanji.length){var q=this.kanji.substring(this.seekPos,this.seekPos+1);this.seekPos++;return q}else{throw"RubyBufferEnd"}};var k={tagHook:{},enableTagHook:function(q){return(typeof this.tagHook[q]!="undefined")},addTagHook:function(r,q){this.tagHook[r]=q},getTagHook:function(q){return this.tagHook[q]}};function b(q,r){this.layout=q;this.seekCharCount=0;this.seekTable=[{spos:0,cpos:0}];this.seekWidth=0;this.seekHeight=0;this.seekLineCharCount=0;this.lineBuff="";this.lineSave="";this.resumePos=-1;this.blockBuff="";this.tagStack=[];this.rubyStack=[];this.pageCache=[];this.boutenStack=[];this.boutenCount=0;this.bouten=false;this.indentCount=0;this.rubyStream=null;this.packStr="";this.textStream=r;this.isResuming=false;this.cacheAble=true;this.fontScale=1;this.lineScale=1;this.bgColor="";this.fontStyle="";this.isImgChar=false;this.isHankaku=false;this.imgBuff=[];this.curImgWidth=0;this.imgIndentCount=0;this.blockIndentCount=0;this.halfWordBreak=false;this.anchors={};this.anchorCount=0;this.anchorName=""}b.prototype.activateTag=function(q,t){var r=["ruby","rp","rb","rt","pack","script","object"];for(var s=0;s<r.length;s++){if(q==r[s]){this[q]=t;return}}};b.prototype.isActiveTag=function(q){if(typeof this[q]=="undefined"){return false}return this[q]};b.prototype.getTextStream=function(){return this.textStream};b.prototype.charToImg=function(q){switch(q){case"「":case"｢":q="kakko1.gif";break;case"」":case"｣":q="kakko2.gif";break;case"『":q="kakko3.gif";break;case"』":q="kakko4.gif";break;case"（":case"(":case"{":q="kakko5.gif";break;case"）":case"}":case")":q="kakko6.gif";break;case"＜":case"<":case"〈":q="kakko7.gif";break;case"＞":case">":case"〉":q="kakko8.gif";break;case"《":case"≪":q="kakko9.gif";break;case"》":case"≫":q="kakko10.gif";break;case"［":case"[":case"〔":q="kakko13.gif";break;case"］":case"]":case"〕":q="kakko14.gif";break;case"【":q="kakko17.gif";break;case"】":q="kakko18.gif";break;case"｡":case"。":q="kuten.gif";break;case"．":case".":q="kuten2.gif";break;case"､":case"、":case",":case"，":q="touten.gif";break;case"～":case"〜":q="kara.gif";break;case"…":q="mmm.gif";break;case"：":case":":q="tenten.gif";break;case"‥":q="mm.gif";break;case"＝":case"=":q="equal.gif";break;case"―":q="dash.gif";break;case"〝":q="dmn1.gif";break;case"〟":q="dmn2.gif";break;case"ー":case"－":case"━":q="｜";break;case"—":case"-":case"‐":case"─":case"−":case"_":case"ｰ":q="｜";break;case"→":case"⇒":q="↓";break;case"←":q="↑";break;case"!":q="！";break;case"?":q="？";break;case"･":q="・";break;case"+":q="＋";break;case"@":q="＠";break;case"#":q="＃";break;case"\\":q="￥";break;default:break}return q};b.prototype.makeCharInner=function(r){var q=this.charToImg(r);if(q.match(/\.gif/)){this.isImgChar=true;var s=(this.layout.charImgColor=="white")?"w@"+q:q;if(typeof this.layout.charImgMap[s]!="undefined"){return this.makeCharImgTag(this.layout.charImgMap[s])}}if(q==r||q.length==1){this.isImgChar=false;return q}this.isImgChar=true;if(this.layout.charImgColor=="white"){q="w_"+q}return this.makeCharImgTag(m.concat(this.layout.charImgRoot,q))};b.prototype.makeCharImgTag=function(u){var s=Math.floor(this.layout.fontSize*this.fontScale);var t=s;var r={"vertical-align":"top",width:s+"px",height:t+"px","line-height":t+"px",margin:"0",padding:"0","border-width":"0"};var q={src:u,style:o(r)};return f("img",q,true)};b.prototype.getBoutenStr=function(q){switch(q){case"bt-disc":return"・";case"bt-accent":return"ヽ";case"bt-circle":return"。";case"bt-dot":return"・"}return"・"};b.prototype.parseAttr=function(u){var t=u.split(/[\s\t　]+/);var r={};var q=this;for(var s=0;s<t.length;s++){(function(w,y){if(w.match(/([^=]+)=(.+)/)){var x=RegExp.$1;var z=q.cutQuote(RegExp.$2);r[x]=z}})(t[s],s)}return r};b.prototype.cutQuote=function(q){return q.replace(/\"/g,"").replace(/\'/g,"")};b.prototype.startBgColor=function(){if(this.layout.isV){var t=Math.floor(this.layout.yohakuHeight*this.lineScale);var s=Math.floor(t/3);var r=Math.floor(this.layout.baseLineHeight*this.lineScale);var q={"text-align":"center",padding:s+"px 0",width:r+"px","background-color":this.bgColor};return f("div",{style:o(q)},false)}else{var q={"padding-top":"0.3em","padding-left":"0.3em","vertical-align":"middle","background-color":this.bgColor};return f("span",{style:o(q)},false)}};b.prototype.endBgColor=function(){if(this.layout.isV){return"</div>"}return"</span>"};b.prototype.makeLineTd=function(){if(this.boutenCount>0){this.boutenStack.push({startPos:this.boutenStartPos,count:this.boutenCount,str:this.boutenStr});this.boutenCount=0;this.boutenStartPos=0}var u=Math.floor(this.layout.fontSize*this.lineScale);var t=Math.floor(this.layout.yohakuHeight*this.lineScale);var q=u+t;var r={"font-size":this.layout.fontSize+"px",margin:"0",padding:"0","text-align":(this.lineScale>1)?"center":"left","line-height":this.layout.letterHeight+"px","vertical-align":"top",width:u+"px"};var s={margin:"0",padding:"0","text-align":"left",width:t+"px","vertical-align":"top"};return(f("td",{style:o(r)},false)+this.lineBuff+"</td>"+f("td",{style:o(s)},false)+this.makeRubyLine()+this.makeBoutenLine()+"</td>")};b.prototype.makeRubyLine=function(){var A="";var F=this;var B=Math.floor(this.layout.rubyFontSize*this.lineScale);var z={position:"absolute","font-size":B+"px","line-height":"1.14em"};var w=o(z);var D=this.indentCount*this.layout.letterHeight;var C=[];var u=this.layout.height-Math.floor(this.fontScale*this.layout.letterHeight*2);for(var v=0;v<this.rubyStack.length;v++){var t=this.rubyStack[v];var r=Math.floor(D+t.startPos);var q=w+"margin-top:"+r+"px;";var x=r;A+=f("div",{style:q},false);for(var s=0;s<t.yomi.length;s++){var E=t.yomi.substring(s,s+1);A+=F.makeCharInner(E)+"<br />";x+=B;if(x>=u){C.push({yomi:t.yomi.slice(s+1),startPos:0});break}}A+="</div>"}this.rubyStack=C;return A};b.prototype.makeLineH=function(){var q="";if(this.rubyStack.length>0){q+=this.makeRubyLineH()}q+="<div>";q+=this.lineBuff+"<br />";if(this.fontStyle!=""){q+="</span>"}if(this.bgColor!=""){q+=this.endBgColor()}q+="</div>";return q};b.prototype.makeRubyLineH=function(){var r="";var q=this;var u=this.indentCount*this.layout.letterHeight;var v=Math.floor(this.layout.rubyFontSize*this.lineScale);var t={"font-size":v+"px",margin:"0",padding:"0","line-height":v+"px"};r+=f("div",{style:o(t)},false);for(var s=0;s<this.rubyStack.length;s++){(function(y,w){var z="position:absolute; margin-top:-0.3em; margin-left:"+Math.floor(u+w.startPos)+"px;";r+=f("span",{style:z},false);for(var x=0;x<w.yomi.length;x++){(function(A,B){r+=B})(x,w.yomi.substring(x,x+1))}r+="</span>"})(s,this.rubyStack[s])}this.rubyStack=[];r+="</div>";return r};b.prototype.makeBoutenLine=function(){var r="";var q=this;var t={position:"absolute","margin-left":"-0.35em"};var u=o(t);for(var s=0;s<this.boutenStack.length;s++){(function(x){while(x.count>0){if(x.str=="・"){var v=q.layout.fontSize}else{if(x.str=="ヽ"){var v=Math.floor(q.layout.fontSize*70/100)}}var w=u+"; font-size:"+v+"px; margin-top:"+x.startPos+"px;";r+=f("div",{style:w},false);r+=x.str;r+="</div>";x.startPos+=q.layout.letterHeight;x.count--}})(this.boutenStack[s])}this.boutenStack=[];return r};b.prototype.normalIndent=function(r){this.isHankaku=false;this.isSmall=false;if(this.lineScale<=1){if(r.match(/[a-z0-9]+/i)){this.isHankaku=true;var q=(r.length>1)?"line-height:1em":"line-height:1em; margin-left:0.25em";return f("span",{style:q},false)+r+"</span><br />"}}if(r.match(/[ぁァぃィぅゥぇェぉォヵヶっッゃャゅュょョゎヮ]/)){this.isSmall=true;var q="overflow:visible;position:relative;top:-0.15em;right:-0.08em;line-height:1em;";return f("span",{style:q},false)+r+"</span><br />"}return this.makeCharInner(r)+"<br />"};b.prototype.toBold=function(q){return("<b>"+q+"</b>")};b.prototype.toStyle=function(q){return(function(r){return("<span style='"+q+"'>"+r+"</span>")})};b.prototype.toLink=function(q){return(function(r){return("<a "+d(q)+">"+r+"</a>")})};b.prototype.isHeadNg=function(q){for(i=0;i<this.layout.headNgChars.length;i++){if(q==this.layout.headNgChars[i]){return true}}return false};b.prototype.isTailNg=function(q){for(i=0;i<this.layout.tailNgChars.length;i++){if(q==this.layout.tailNgChars[i]){return true}}return false};b.prototype.applyTagStack=function(t,s){var q=s?this.normalIndent(t):t;for(i=this.tagStack.length-1;i>=0;i--){var r=this.tagStack[i];q=r(q)}return q};b.prototype.isValidPageRange=function(q){return(0<=q&&q<this.seekTable.length)};b.prototype.setSeekPage=function(q){if(this.isValidPageRange(q)){this.textStream.seekPos=this.seekTable[q].spos;this.seekWidth=0;this.seekHeight=0;this.seekLineCharCount=0;if(q==0){this.tagStack=[]}}};b.prototype.getPageSeekPos=function(q){if(this.isValidPageRange(q)){return this.seekTable[q]}return 0};b.prototype.getSeekPercent=function(q){if(q<this.seekTable.length-1){return Math.floor(100*this.seekTable[q+1].spos/this.textStream.length)}return 100};b.prototype.getPageSourceText=function(q){if(q<this.seekTable.length){var s=this.seekTable[q].spos;if(q+1<this.seekTable.length){var r=this.seekTable[q+1].spos;return this.textStream.buffer.substring(s,r)}}return""};b.prototype.getPageNoFromSeekPos=function(r){for(var q=0;q<this.seekTable.length-1;q++){if(this.seekTable[q].spos<=r&&r<this.seekTable[q+1].spos){return q}}if(this.seekTable[q].spos<=r&&r<=this.textStream.buffer.length){return q}return -1};b.prototype.makeRestSpaceTd=function(){var r=this.layout.width-this.seekWidth;var q="";if(r>0){q="<td style='display:block; width:"+r+"px; height:"+this.layout.height+"'></td>\n"}return q};b.prototype.getPageSeekPos=function(q){if(this.isValidPageRange(q)){return this.seekTable[q]}return{spos:0,cpos:0}};b.prototype.saveSeekState=function(q,r){if(this.isValidPageRange(q)){this.seekTable[q]=r}else{this.seekTable.push(r)}};b.prototype.fixH=function(q){if(q=="―"){return"<span style='margin-top:-0.2em; float:right'>"+q+"</span>"}return q};b.prototype.fixW=function(q){if(q=="―"||q=="…"){return"<span style='margin-left:-0.24em'>"+q+"</span>"}return q};b.prototype.hasNextPage=function(){return(this.textStream.seekPos<this.textStream.length)};b.prototype.addCache=function(r,q){this.pageCache[r]=q};b.prototype.getCache=function(q){return this.pageCache[q]};b.prototype.clearCache=function(){this.pageCache=[];this.tagStack=[]};b.prototype.reset=function(){this.clearCache();this.textStream.seekPos=0};b.prototype.getLetterCount=function(q){if(escape(q).charAt(1)=="u"){return 1}else{if(!this.layout.isV){return 0.5}else{return(q==" ")?1:g.canTransform?0.5:1}}};b.prototype.addIndent=function(r){var s=(this.layout.isV)?"　<br />":"　";for(var q=0;q<r;q++){this.lineBuff+=s}};b.prototype.getLayout=function(){return this.layout};b.prototype.setLayout=function(q){this.layout=q;this.layout.initialize()};b.prototype.getAnchors=function(){return this.anchors};b.prototype.getAnchorCount=function(){return this.anchorCount};b.prototype.getPageLayout=function(u,q){var t="<"+this.layout.wrapTag+" class='"+this.layout.textLayerClassName+"' style='"+this.layout.wrapCss+"'>";var s="</"+this.layout.wrapTag+">";var r=(q!="")?t+q+s:"";this.addCache(u,r);return r};b.prototype.outputPage=function(q){if(this.isResuming){this.isResuming=false;return this.parsePage(q)}else{if(typeof this.pageCache[q]!="undefined"){this.setSeekPage(q+1);return this.pageCache[q]}else{this.setSeekPage(q);return this.parsePage(q)}}};b.prototype.onOverFlowPage=function(q,s){if(s){if(this.layout.directionH=="rl"){this.blockBuff=this.makeRestSpaceTd()+this.blockBuff}else{this.blockBuff=this.blockBuff+this.makeRestSpaceTd()}}var r=(s)?"<tr>"+this.blockBuff+"</tr>":this.blockBuff;this.saveSeekState(q+1,{spos:this.textStream.seekPos,cpos:this.seekCharCount});this.blockBuff="";this.lineBuff="";if(this.bgColor!=""){this.lineBuff+=this.startBgColor()}this.lineScale=this.fontScale;if(s){this.seekWidth=0}else{this.seekHeight=0}this.seekLineCharCount=0;return this.getPageLayout(q,r)};b.prototype.onBufferEnd=function(q,r){if(this.textStream.isEOF){if(this.lineBuff!=""){this.pushLine(q,r)}return this.onOverFlowPage(q,r)}else{this.isResuming=true;if(this.resumePos>=0){this.textStream.seekPos=this.resumePos;this.lineBuff=this.lineSave}throw"BufferEnd"}};b.prototype.onRubyBufferEnd=function(q,r){delete this.rubyStream;this.rubyStream=null};b.prototype.pushLineToBlockV=function(q){if(this.layout.directionH=="rl"){this.blockBuff=q+this.blockBuff}else{this.blockBuff+=q}};b.prototype.pushLine=function(q,r){if(this.blockBuff!=""||this.lineBuff!=""){if(r){if(this.halfBuff){this.lineBuff+=this.outputHalfWord();if(this.getLetterCount(this.textStream.lookNextChar())<1){this.halfWordBreak=true}}this.pushLineToBlockV(this.makeLineTd())}else{this.blockBuff+=this.makeLineH()}this.lineBuff="";if(this.fontStyle!=""){this.lineBuff+=fontStyle}if(this.bgColor!=""){this.lineBuff=this.startBgColor()}if(r){this.seekWidth+=Math.floor(this.layout.baseLineHeight*this.lineScale);this.seekHeight=0}else{this.seekHeight+=Math.floor(this.layout.baseLineHeight*this.lineScale);this.seekWidth=0}this.seekLineCharCount=0;this.lineScale=this.fontScale}};b.prototype.checkOverflow=function(q){if(q){return(this.seekWidth+Math.floor(this.layout.fontSize*this.lineScale)>this.layout.width)}return(this.seekHeight+Math.floor((this.layout.fontSize+this.layout.rubyFontSize)*this.lineScale)>this.layout.height)};b.prototype.parseEndPage=function(s,u,t,r,q){if(this.lineBuff!=""){this.pushLine(s,u)}if(this.recursiveParser){this.textStream.seekPos=this.resumePos}throw"OverflowPage"};b.prototype.adjustSize=function(s,v,u,q){var r=s;var t=v;if(s>u){r=u;t-=Math.floor((v/s)*(s-u))}if(v>q){t=q;r-=Math.floor((s/v)*(v-q))}return{width:r,height:t}};b.prototype.parseObjectStart=function(t,w,v,s,q){var r=parseInt(s.width);var u=parseInt(s.height);var x=(typeof s.align!="undefined")?s.align:"none";this.objFigure={src:v,align:x,width:r,height:u,drawWidth:r,drawHeight:u}};b.prototype.parseObjectBody=function(s,u,t,r,q){if(this.objFigure){this.objFigure.src+=t}};b.prototype.parseObjectEnd=function(s,u,t,r,q){this.objFigure.src+=t;this.pushFigure(s,u,"object",this.objFigure)};b.prototype.parseImg=function(y,s,z,C,v){var r=C.src;var u=(typeof C.width!="undefined")?parseInt(C.width):200;var B=(typeof C.height!="undefined")?parseInt(C.height):300;var x=(typeof C.align!="undefined")?C.align:"none";var w=this.layout.width-this.seekWidth;var A=this.layout.height-this.seekHeight;var q=this.layout.letterHeight*2;if(s){A=Math.max(10,A-q)}else{w=Math.max(10,w-q)}var t=this.adjustSize(u,B,w,A);this.pushFigure(y,s,"img",{src:r,align:x,width:u,height:B,drawWidth:t.width,drawHeight:t.height})};b.prototype.pushFigure=function(z,r,x,s){if(this.lineBuff!=""){this.pushLine(z,r);if(this.checkOverflow(r)){this.textStream.seekPos=this.resumePos;throw"OverflowPage"}}if(this.recursiveParser){if(this.lineBuff!=""){this.pushLine(z,r)}this.textStream.seekPos=this.resumePos;throw"OverflowPage"}if((r&&s.width>this.layout.width)||(!r&&s.height>this.layout.height)){return}if((r&&this.seekWidth+s.drawWidth+this.layout.yohakuHeight>this.layout.width)||(!r&&this.seekHeight+s.drawHeight+this.layout.yohakuHeight>this.layout.height)){this.textStream.seekPos=this.resumePos;throw"OverflowPage"}if((s.drawWidth!=s.width||s.drawHeight!=s.height)&&(s.drawWidth*2<s.width||s.drawHeight*2<s.height)){this.textStream.seekPos=this.resumePos;throw"OverflowPage"}if(r){var B=this.layout.height-s.drawHeight-this.layout.fontSize}else{var B=this.layout.width-s.drawWidth-this.layout.fontSize}var t="";if(r){if(!this.textStream.isEOF||s.align=="none"||B<=0||B*2<this.layout.height){if(x=="img"){var v=f("img",{src:s.src,width:s.drawWidth,height:s.drawHeight},true)}else{var v=s.src}v=this.applyTagStack(v,false)}else{if(s.align=="top"||s.align=="left"){var q="padding:0; margin-bottom:"+this.layout.fontSize+"px;"}else{if(s.align=="bottom"||s.align=="right"){var q="padding:0; margin-top:0;"}}if(x=="img"){var v=f("img",{src:s.src,width:s.drawWidth,height:s.drawHeight,style:q},true)}else{var v=f("div",{style:q},false)+s.src+"</div>"}v=this.applyTagStack(v,false);var w=new b(new l({width:s.drawWidth,height:B,fontSize:this.layout.fontSize,direction:this.layout.direction,charImgRoot:this.layout.charImgRoot,charImgMap:this.layout.charImgMap,charImgColor:this.layout.charImgColor,kinsokuCharCount:this.layout.kinsokuCharCount}),this.textStream);w.recursiveParser=true;if(this.layout.fontFamily){w.layout.fontFamily=this.layout.fontFamily;w.layout.initialize()}t=w.parsePage(0);this.tagStack=w.tagStack;delete w}var u={"vertical-align":"top","padding-right":this.layout.yohakuHeight+"px"};var C=(s.align=="top"||s.align=="left")?v+t:t+v;this.blockBuff=f("td",{style:o(u)},false)+C+"</td>"+this.blockBuff;this.seekWidth+=s.drawWidth+this.layout.yohakuHeight}else{if(!this.textStream.isEOF||s.align=="none"||B<=0||B*2<this.layout.width){if(x=="img"){var v=f("img",{src:s.src,width:s.drawWidth,height:s.drawHeight},true)}else{var v=s.src}this.blockBuff+=v+"<br />";this.seekHeight+=s.drawHeight+this.layout.yohakuHeight}else{if(x=="img"){var v=f("img",{src:s.src,width:s.drawWidth,height:s.drawHeight},true)}else{var v=s.src}var w=new b(new l({width:B,height:s.drawHeight,fontSize:this.layout.fontSize,direction:"horizontal",charImgRoot:this.layout.charImgRoot,charImgMap:this.layout.charImgMap,charImgColor:this.layout.charImgColor,kinsokuCharCount:1}),this.textStream);w.recursiveParser=true;if(this.layout.fontFamily){w.layout.fontFamily=this.layout.fontFamily;w.layout.initialize()}t=w.parsePage(0);delete w;if(s.align=="top"||s.align=="left"){var y="<div style='float:left; width:"+(s.drawWidth+this.layout.fontSize)+"px;'>"+v+"</div>";var A="<div style='float:left; width:"+B+"px;'>"+t+"</div>"}else{if(s.align=="bottom"||s.align=="right"){var y="<div style='float:left; width:"+B+"px;'>"+t+"</div>";var A="<div style='float:left; width:"+(s.drawWidth+this.layout.fontSize)+"px;'>"+v+"</div>"}}this.blockBuff+=("<div style='width:"+this.layout.width+"px;'>"+y+A+"<div style='clear:left;line-height:0px;font-size:0px;'></div></div>");this.seekHeight+=s.drawHeight+this.layout.yohakuHeight}}};b.prototype.parseLinkStart=function(s,u,t,r,q){if(q=="a2"){r.target="_blank"}if(r.name){this.anchorName=r.name;this.anchors[this.anchorName]={title:"",pageNo:s};this.anchorCount++}else{if(u){this.tagStack.push(this.toLink(r))}else{this.lineBuff+="<a "+d(r)+">"}}};b.prototype.parseLinkEnd=function(s,u,t,r,q){if(this.anchorName!=""){this.anchorName=""}else{if(u){this.tagStack.pop()}else{if(q=="/a2"){this.lineBuff+="</a>"}else{this.lineBuff+=t}}}};b.prototype.parseBoldStart=function(s,u,t,r,q){if(u){this.tagStack.push(this.toBold)}else{this.lineBuff+=t}};b.prototype.parseBoldEnd=function(s,u,t,r,q){if(u){this.tagStack.pop()}else{this.lineBuff+=t}};b.prototype.parseFontStart=function(u,w,v,t,q){var r={};this.fontScale=(typeof t.scale!="undefined")?parseFloat(t.scale):1;if(this.fontScale<1||this.fontScale>1){r["font-size"]=this.fontScale+"em";if(w){r["line-height"]="1.1em"}}if(this.fontScale>this.lineScale){this.lineScale=this.fontScale}if(typeof t.color!="undefined"){r.color=t.color}if(typeof t.family!="undefined"){r["font-family"]=t.family}if(typeof t.weight!="undefined"){r["font-weight"]=t.weight}this.bgColor=(typeof t.bgcolor!="undefined")?t.bgcolor:"";if(this.bgColor!=""){this.lineBuff+=this.startBgColor()}var s=o(r);if(s!=""){s+="vertical-align:baseline;";if(w){this.tagStack.push(this.toStyle(s))}else{this.fontStyle=f("span",{style:s},false);this.lineBuff+=this.fontStyle}}};b.prototype.parseFontEnd=function(s,u,t,r,q){this.fontScale=1;if(this.seekLineCharCount==0){this.lineScale=1}if(u){if(this.bgColor!=""){this.lineBuff+=this.endBgColor();this.bgColor=""}this.tagStack.pop()}else{this.fontStyle="";this.lineBuff+="</span>";if(this.bgColor!=""){this.lineBuff+=this.endBgColor();this.bgColor=""}}};b.prototype.parseBoutenStart=function(s,u,t,r,q){this.bouten=true;this.boutenStartPos=this.seekHeight;if(g.isIE){this.boutenStartPos+=Math.floor(this.layout.baseLetterSpacing*this.fontScale)}this.boutenStr=this.getBoutenStr(q)};b.prototype.parseBoutenEnd=function(s,u,t,r,q){this.bouten=false;this.boutenStack.push({startPos:this.boutenStartPos,count:this.boutenCount,str:this.boutenStr});this.boutenCount=0};b.prototype.parsePackStart=function(s,u,t,r,q){if(u){this.packStr=""}};b.prototype.parseRubyStart=function(s,u,t,r,q){if(u){this.rubyStream=new e(this.seekHeight)}else{this.rubyStream=new e(this.seekWidth)}};b.prototype.parseRubyEnd=function(s,u,t,r,q){this.rubyStack.push({yomi:this.rubyStream.yomi,startPos:this.rubyStream.rubyStartPos});this.rubyStream.setReady()};b.prototype.parseBlockquoteStart=function(s,u,t,r,q){this.blockIndentCount=(typeof r.indent!="undefined")?parseInt(r.indent):2;this.indentCount+=this.blockIndentCount;if(this.lineCount<=this.indentCount*2){this.activateTag("blockquote",false)}this.layout.lineCount-=this.blockIndentCount*2};b.prototype.parseBlockquoteEnd=function(s,u,t,r,q){this.indentCount-=this.blockIndentCount;this.layout.lineCount+=this.blockIndentCount*2;this.blockIndentCount=0};b.prototype.parseTagHook=function(t,v,u,s,r,q){if(k.enableTagHook(r)){k.getTagHook(r).apply(this,[t,v,u,s,r])}};b.prototype.parseTag=function(t,w){var v=this.textStream.getTag();var q=v.replace("<","").replace(">","").replace("/>","");var s=this.parseAttr(q);var r=q.split(/[\s\t]+/)[0].toLowerCase();var u=(r.substring(0,1)=="/");this.activateTag(r.replace("/",""),!u);switch(r){case"end-page":this.parseEndPage(t,w,v,s,r);break;case"img":this.parseImg(t,w,v,s,r);break;case"a":case"a2":this.parseLinkStart(t,w,v,s,r);break;case"/a":case"/a2":this.parseLinkEnd(t,w,v,s,r);break;case"b":case"strong":this.parseBoldStart(t,w,v,s,r);break;case"/b":case"/strong":this.parseBoldEnd(t,w,v,s,r);break;case"font":this.parseFontStart(t,w,v,s,r);break;case"/font":this.parseFontEnd(t,w,v,s,r);break;case"bt-disc":case"bt-accent":case"bt-circle":case"bt-dot":this.parseBoutenStart(t,w,v,s,r);break;case"/bt-disc":case"/bt-accent":case"/bt-circle":case"/bt-dot":this.parseBoutenEnd(t,w,v,s,r);break;case"pack":this.parsePackStart(t,w,v,s,r);break;case"ruby":this.parseRubyStart(t,w,v,s,r);break;case"/ruby":this.parseRubyEnd(t,w,v,s,r);break;case"blockquote":this.parseBlockquoteStart(t,w,v,s,r);break;case"/blockquote":this.parseBlockquoteEnd(t,w,v,s,r);break;case"object":this.parseObjectStart(t,w,v,s,r);break;case"/object":this.parseObjectEnd(t,w,v,s,r);break;case"embed":case"/embed":case"param":case"/param":this.parseObjectBody(t,w,v,s,r);break;default:this.parseTagHook(t,w,v,s,r);break}};b.prototype.checkTailNg=function(r,s){var q=this.textStream.lookNextChar();if(this.isTailNg(q)){this.pushLine(r,s);this.textStream.skipCRLF()}};b.prototype.checkHeadNg=function(s,t){var r=this.textStream.lookNextChar();if(this.isHeadNg(r)){this.textStream.stepSeekPos();this.seekCharCount++;if(this.bouten){this.boutenCount++}if(t){this.lineBuff+=this.applyTagStack(r,true)}else{this.lineBuff+=this.fixW(r)}var q=this.textStream.lookNextChar();if(this.isHeadNg(q)){this.textStream.stepSeekPos();this.seekCharCount++;if(this.bouten){this.boutenCount++}this.lineBuff+=this.applyTagStack(q,true)}}this.pushLine(s,t);this.textStream.skipCRLF()};b.prototype.outputHalfWord=function(){if(this.halfBuff.length==1){var s=this.applyTagStack(this.halfBuff,true)}else{if(this.halfBuff.length==2&&!this.halfWordBreak&&(this.halfBuff.match(/\d+/)||this.halfBuff.match(/[!\?]+/))){var s=this.applyTagStack(this.halfBuff,true)}else{if(g.isIE){var t=o({"writing-mode":"tb-rl",width:this.layout.fontSize+"px"});var s="<div class='hw-tbrl' style='"+t+"'>"+this.applyTagStack(this.halfBuff,false)+"</div>"}else{var r=this.fontScale*this.layout.fontSize/2;var q=Math.max(0,Math.floor((this.halfBuff.length-2)*r));var t=o({"-webkit-transform":"rotate(90deg)","-webkit-transform-origin":"50% 50%","-moz-transform":"rotate(90deg)","-moz-transform-origin":"50% 50%","margin-bottom":q+"px",width:this.layout.fontSize+"px"});var s="<div class='hw-trans' style='"+t+"'>"+this.applyTagStack(this.halfBuff,false)+"</div>"}}}delete this.halfBuff;this.halfBuff=null;this.halfWordBreak=false;return s};b.prototype.pushHalfChar=function(r){if(this.halfBuff){this.halfBuff+=r}else{this.halfBuff=r}var q=this.textStream.lookNextChar();if(this.getLetterCount(q)>=1||q=="<"||q==" "||q=="　"||q=="\t"||q=="\r"||q=="\n"){this.lineBuff+=this.outputHalfWord()}};b.prototype.pushChar=function(s,u,q){if(this.anchorName!=""){this.anchors[this.anchorName].title+=q}var v=this.getLetterCount(q);var t=v*this.fontScale;if(this.seekLineCharCount==0&&this.indentCount>0){this.addIndent(this.indentCount)}if(u){if(v<1&&g.canTransform){this.pushHalfChar(q)}else{this.lineBuff+=this.applyTagStack(q,true)}if(this.isImgChar){this.seekHeight+=Math.floor(t*this.layout.fontSize)}else{if(this.isHankaku||this.isSmall){this.seekHeight+=Math.floor(t*this.layout.fontSize)}else{this.seekHeight+=Math.floor(t*this.layout.letterHeight)}}}else{this.lineBuff+=this.fixW(q);this.seekWidth+=Math.floor(t*this.layout.fontSize)}this.seekLineCharCount+=t;this.seekCharCount++;if(this.bouten){this.boutenCount++}var r=this.layout.lineCount-this.seekLineCharCount;if(1<=r&&r<=1.5){this.checkTailNg(s,u)}else{if(r<1){this.checkHeadNg(s,u)}}};b.prototype.parsePage=function(r){var u=this.layout.isV;this.lineSave="";while(true){try{this.resumePos=-1;var t=this.textStream.seekPos;if(!this.pack&&this.packStr!=""){var q=this.packStr;this.packStr=""}else{if(this.rubyStream&&this.rubyStream.isReady()){var q=this.rubyStream.getchar()}else{var q=this.textStream.getchar()}}if(q=="\r"){}else{if(q=="\n"){this.pushLine(r,u)}else{if(q=="<"){this.lineSave=this.lineBuff;this.resumePos=t;this.parseTag(r,u)}else{if(this.isActiveTag("pack")){this.packStr+=q}else{if(this.isActiveTag("ruby")){if(this.isActiveTag("rt")){this.rubyStream.addYomi(q)}else{if(this.isActiveTag("rb")){this.rubyStream.addKanji(q)}}}else{if(this.isActiveTag("script")){}else{this.pushChar(r,u,q)}}}}}}if(this.checkOverflow(u)){throw"OverflowPage"}}catch(s){if(s=="RubyBufferEnd"){this.onRubyBufferEnd(r,u)}else{if(s=="OverflowPage"){return this.onOverFlowPage(r,u)}else{if(s=="BufferEnd"){return this.onBufferEnd(r,u)}}}}}};var a={parse:function(u){var t=u.split(/[\s\t]/);var r={direction:"vertical",fontSize:16,width:400,height:300,order:0,charImgColor:"black",isSinglePaging:false};for(var s=0;s<t.length;s++){var q=t[s];if(q=="lp-vertical"||q=="lp-vertical-rl"){r.direction="vertical"}else{if(q=="lp-vertical-lr"){r.direction="vertical-lr"}else{if(q=="lp-horizontal"){r.direction="horizontal"}else{if(q.match(/span-([0-9]+)/)){r.width=parseInt(RegExp.$1)*40-10}else{if(q.match(/lp-width-([0-9]+)/)){r.width=parseInt(RegExp.$1)}else{if(q.match(/lp-height-([0-9]+)/)){r.height=parseInt(RegExp.$1)}else{if(q.match(/lp-font-size-([0-9]+)/)){r.fontSize=parseInt(RegExp.$1)}else{if(q.match(/lp-order-([0-9]+)/)){r.order=parseInt(RegExp.$1)}else{if(q.match(/lp-char-img-white/)){r.charImgColor="white"}else{if(q.match(/lp-single-paging/)){r.isSinglePaging=true}}}}}}}}}}}return r}};function j(u,t,s){this.grids=t.sort(function(B,A){return(B.order-A.order)});this.head=this.grids[0];var y=this.head.node.innerHTML;if(g.isIE||!s.noBR){y=y.replace(/<br \/>/gi,"\n").replace(/<br>/gi,"\n")}this.head.node.innerHTML="";this.fontFamily=s.fontFamily;this.onSeek=s.onSeek;this.onComplete=s.onComplete;this.charImgRoot=s.charImgRoot;this.groupName=u;this.gridIndex=0;this.parser=new b(new l({direction:this.head.direction,width:this.head.width,height:this.head.height,fontSize:this.head.fontSize,fontFamily:this.fontFamily,kinsokuCharCount:1,letterSpacingRate:0.1,charImgRoot:this.charImgRoot,charImgColor:this.head.charImgColor}),new c(y,y.length,true));if(this.head.isSinglePaging){var z=this;this.pager=document.createElement("div");var w=document.createElement("a");var q=document.createElement("a");this.pager.className="nehan-pager";w.href="/next";w.className="nehan-pager-link";q.innerHTML="PREV &gt;";q.href="/prev";q.className="nehan-pager-link";w.onclick=function(){if(z.parser.hasNextPage()){z.gridIndex++;z.render(z.gridIndex)}return false};q.onclick=function(){if(z.gridIndex>0){z.gridIndex--;z.render(z.gridIndex)}return false};if(this.head.direction.match("vertical")){w.innerHTML="&lt; NEXT";q.innerHTML="PREV &gt;";this.pager.appendChild(w);this.pager.appendChild(q)}else{w.innerHTML="NEXT &gt;";q.innerHTML="&lt; PREV";this.pager.appendChild(q);this.pager.appendChild(w)}this.seekBar=document.createElement("div");this.seekBar.className="nehan-seek-bar-wrapper";var x=this.seekBar.style;x.width=this.head.width+"px";x.height="12px";x.lineHeight="12px";var r=document.createElement("div");var v=r.style;r.className="nehan-seek-bar";v.width="0%";v["float"]="right";v["text-align"]="right";v["font-size"]="10px";r.innerHTML="0%";this.seekBar.appendChild(r)}}j.prototype.setGridLayout=function(r){var q=this.parser.layout;q.setDirection(r.direction);q.setWidth(r.width);q.setHeight(r.height);q.setFontSize(r.fontSize);q.setFontFamily(this.fontFamily);q.setCharImgColor(r.charImgColor);q.setCharImgRoot(this.charImgRoot);q.initialize()};j.prototype.getGrid=function(q){return(q<this.grids.length)?this.grids[q]:this.grids[this.grids.length-1]};j.prototype.render=function(r){this.gridIndex=r;var q=(this.head.isSinglePaging)?this.head:this.getGrid(r);this.setGridLayout(q);var v=this.parser.outputPage(r);var t=!this.parser.hasNextPage();var s=this.parser.getSeekPercent(r);this.onSeek(this.groupName,s);var u=function(z){var A=document.createElement("div");A.className=z;A.innerHTML=v;return A};if(v!=""){var w="text-layer-wrapper";if(r==0){w+=" text-layer-header"}if(t){w+=" text-layer-footer"}if(this.head.isSinglePaging){if(typeof this.pagerInit=="undefined"){this.pagerInit=true;t=true;this.textLayer=u(w);this.textLayer.style.height=this.head.height+"px";q.node.appendChild(this.pager);q.node.appendChild(this.textLayer);q.node.appendChild(this.seekBar)}else{this.textLayer.innerHTML=v}var x=this.seekBar.firstChild;x.style.width=Math.max(20,Math.floor(s))+"%";x.innerHTML=s+"%"}else{if(r<this.grids.length){q.node.innerHTML="<div class='"+w+"'>"+v+"</div>"}else{q.node.appendChild(u(w))}}}if(t){h.setFinish(this.groupName);this.onComplete(this.groupName,h.getSeekPercent());h.checkFinish()}else{if(!this.head.isSinglePaging){var y=this;setTimeout(function(){y.render(r+1)},0)}}};var h={setFinish:function(q){this.gridMappedCount++},getSeekPercent:function(){return Math.floor(100*this.gridMappedCount/this.gridCount)},checkFinish:function(){if(this.gridMappedCount>=this.gridCount){this.onCompleteAll()}},start:function(B,u){var v={filter:"direction",noBR:false,charImgRoot:"/img/char",fontFamily:"IPA明朝, ＭＳ 明朝, Osaka-Mono, Hiragino Mincho Pro",onSeek:function(E,D){},onComplete:function(E,D){},onCompleteAll:function(){}};if(typeof u=="undefined"){u={}}for(var r in v){if(r=="onCompleteAll"){this[r]=(typeof u[r]!="undefined")?u[r]:v[r]}else{u[r]=(typeof u[r]!="undefined")?u[r]:v[r]}}var q=document.getElementsByTagName(B);var x=function(F,G,D){var E=a.parse(D);E.node=F;E.tagGroup=B;return E};var w={};this.gridCount=0;this.gridMappedCount=0;for(var y=0;y<q.length;y++){var t=q[y];var s=false;if(u.filter=="group"){if(t.className.match(/lp-group-([a-zA-Z0-9\-_]+)/)){var C=RegExp.$1;s=true}}else{if(u.filter=="direction"){if(t.className.match(/lp-vertical/)){var C="group-v"+y;s=true}else{if(t.className.match(/lp-horizontal/)){var C="group-h"+y;s=true}}}}if(s){this.gridCount++;var A=t.className;var z=x(t,C,A);if(typeof w[C]=="undefined"){w[C]=[z]}else{w[C].push(z)}}}for(var C in w){(new j(C,w[C],u)).render(0)}}};Nehan.Env=g;Nehan.Layout=l;Nehan.TextStream=c;Nehan.StreamParser=b;Nehan.LayoutMapper=h;Nehan.ParserHook=k})();